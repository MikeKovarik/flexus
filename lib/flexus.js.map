{"version":3,"file":"flexus.js","sources":["src/lib/flexus/appElement.js","src/lib/flexus/platform.js","src/lib/flexus/iridescent.js","src/lib/flexus/loader.js","src/lib/flexus/theme.js","src/lib/flexus/battery.js","src/lib/flexus/utils.js","src/lib/flexus/animation.js","src/lib/flexus/resizeDetector.js","src/lib/flexus/raf.js","src/lib/flexus/breakpoints.js","src/lib/flexus/Draggable.js","src/lib/flexus/Panel.js","src/lib/flexus/Scrollable.js","src/lib/flexus/LinearSelectable.js","src/lib/flexus/Visibility.js","src/lib/flexus/flexus.js"],"sourcesContent":["export var app\r\nexport var appElementReady = new Promise(resolve => {\r\n\tapp = document.querySelector('[fx-app]')\r\n\tif (app) {\r\n\t\treturn resolve(app)\r\n\t}\r\n\tfunction listener(e) {\r\n\t\tapp = document.querySelector('[fx-app]')\r\n\t\tif (app) {\r\n\t\t\tresolve(app)\r\n\t\t} else {\r\n\t\t\tapp = document.body\r\n\t\t\tapp.setAttribute('fx-app', '')\r\n\t\t\tresolve(app)\r\n\t\t}\r\n\t\tdocument.removeEventListener('DOMContentLoaded', listener)\r\n\t}\r\n\tdocument.addEventListener('DOMContentLoaded', listener)\r\n})\r\n","import {emit} from 'ganymede'\r\nimport {appElementReady} from './appElement'\r\n\r\n\r\n// Windows.System.Profile.AnalyticsInfo.DeviceForm\r\n\r\nvar ua = navigator.userAgent\r\n\r\nexport var platform = {\r\n\t// orientation\r\n\tportrait: undefined,\r\n\tlandscape: undefined,\r\n\t// design\r\n\tneon: undefined,\r\n\tmaterial: undefined,\r\n\t// system\r\n\twindows:  ua.includes('Windows'),\r\n\tandroid:  ua.includes('Android'),\r\n\tchromeos: ua.includes('CrOS'),\r\n\t// browser\r\n\tedge:   ua.includes('Edge'),\r\n\tchrome: ua.includes('Chrome') && !ua.includes('Edge'), ///////////////////////////////\r\n\t// runtime\r\n\tuwp: typeof Windows !== 'undefined',\r\n\tcordova: undefined,\r\n\tchromeapp: undefined,\r\n\t// apis\r\n\tnativeCustomComponents: window.customElements && customElements.constructor.name === 'CustomElementRegistry',\r\n\t// TODO - deprecate\r\n\tphone: undefined,\r\n\ttablet: undefined,\r\n}\r\n\r\nplatform.csp = platform.uwp || platform.chromeapp\r\n\r\nif (navigator.maxTouchPoints > 0) {\r\n\tplatform.touch = true\r\n\tplatform.nontouch = false\r\n\tplatform.inputType = 'touch'\r\n} else {\r\n\tplatform.touch = true\r\n\tplatform.nontouch = false\r\n\tplatform.inputType = 'nontouch'\r\n}\r\n\r\nwindow.platform = platform\r\n\r\n// TODO deprecate\r\nfunction determineFormfactor() {\r\n\tplatform.phone = platform.phablet = platform.tablet = platform.laptop = platform.desktop = false\r\n\t//if (platform.touch) {\r\n\t\tswitch (platform.screensize) {\r\n\t\t\tcase 'small':\r\n\t\t\t\tplatform.phone = true\r\n\t\t\t\tbreak\r\n\t\t\tcase 'medium':\r\n\t\t\t\tplatform.phablet = true\r\n\t\t\t\tplatform.tablet = true\r\n\t\t\t\tbreak\r\n\t\t\tcase 'large':\r\n\t\t\t\tplatform.tablet = true\r\n\t\t\t\tbreak\r\n\t\t}\r\n\t//} else {\r\n\t//}\r\n\tapplyFormfactorAttributes()\r\n}\r\n\r\n// todo deprecate\r\nfunction applyFormfactorAttributes() {\r\n\tvar htmlNode = document.body.parentElement\r\n\t//console.log('applyFormfactorAttributes')\r\n\tif (platform.phone)\r\n\t\thtmlNode.setAttribute('phone', '')\r\n\telse\r\n\t\thtmlNode.removeAttribute('phone')\r\n\tif (platform.phablet)\r\n\t\thtmlNode.setAttribute('phablet', '')\r\n\telse\r\n\t\thtmlNode.removeAttribute('phablet')\r\n\tif (platform.tablet)\r\n\t\thtmlNode.setAttribute('tablet', '')\r\n\telse\r\n\t\thtmlNode.removeAttribute('tablet')\r\n}\r\n\r\n\r\n\r\n// assign default color theme if none provided\r\nappElementReady.then(appElement => {\r\n\tdetermineFormfactor()\r\n\r\n\tvar targetNode = document.body.parentElement\r\n\t//var targetNode = appElement\r\n\r\n\t// assigning [touch] or [nontouch]\r\n\tif (targetNode.hasAttribute('touch') || targetNode.hasAttribute('nontouch')) {\r\n\t\tif (targetNode.hasAttribute('touch')) {\r\n\t\t\tplatform.touch = true\r\n\t\t\tplatform.nontouch = false\r\n\t\t\tplatform.inputType = 'touch'\r\n\t\t} else {\r\n\t\t\tplatform.touch = false\r\n\t\t\tplatform.nontouch = true\r\n\t\t\tplatform.inputType = 'nontouch'\r\n\t\t}\r\n\t} else {\r\n\t\ttargetNode.setAttribute(platform.inputType, '')\r\n\t}\r\n})\r\n\r\ndocument.addEventListener('formfactor-update', determineFormfactor)\r\n\r\n\r\n\r\n\r\n/*\r\nexport function PlatformBool(element, propName, attrValue) {\r\n\tif (!element[propName + 'temp']) {\r\n\t\tdocument.addEventListener('formfactor-update', e => {\r\n\t\t\tPlatformBool(element, propName, attrValue)\r\n\t\t})\r\n\t\telement[propName + 'temp'] = true\r\n\t}\r\n\telement[propName] = platformConditionParser(attrValue)\r\n}\r\n\r\nfunction platformConditionParser(condition) {\r\n\treturn condition\r\n\t\t.split(';')\r\n\t\t.map(platformConditionParserLogic)\r\n\t\t.some(a => a)\r\n}\r\nfunction platformConditionParserLogic(condition) {\r\n\tswitch(condition) {\r\n\t\tcase 'phone':\r\n\t\t\treturn platform.phone\r\n\t\t\tbreak\r\n\t\tcase 'tablet':\r\n\t\t\treturn platform.tablet\r\n\t\t\tbreak\r\n\t}\r\n}\r\n*/","// TODO implement UWP accent color (since the theme <meta> tag is already handled)\r\n\r\n\r\nexport class iridescent {\r\n\r\n\r\n\t///////////////////////////////////////////////////////////////////////////\r\n\t/////////////////////////////// CONVERSIONS ///////////////////////////////\r\n\t///////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\tstatic hexToRgb(string) {\r\n\t\tif (string.startsWith('#'))\r\n\t\t\tstring = string.slice(1)\r\n\t\tvar r = parseInt(string.substr(0,2), 16)\r\n\t\tvar g = parseInt(string.substr(2,2), 16)\r\n\t\tvar b = parseInt(string.substr(4,2), 16)\r\n\t\treturn [r, g, b]\r\n\t}\r\n\r\n\tstatic rgbToHex(r, g, b) {\r\n\t\tvar int = r << 16 | g << 8 | b\r\n\t\treturn '#' + ('00000' + int.toString(16)).slice(-6).toUpperCase()\r\n\t}\r\n\r\n\tstatic rgbToHsl(r, g, b) {\r\n\t\tr /= 255\r\n\t\tg /= 255\r\n\t\tb /= 255\r\n\t\tvar max = Math.max(r, g, b)\r\n\t\tvar min = Math.min(r, g, b)\r\n\t\tvar h\r\n\t\tvar s\r\n\t\tvar l = (max + min) / 2\r\n\t\tif (max == min) {\r\n\t\t\th = s = 0 // achromatic\r\n\t\t} else {\r\n\t\t\tvar d = max - min\r\n\t\t\ts = l > 0.5 ? d / (2 - max - min) : d / (max + min)\r\n\t\t\tswitch (max) {\r\n\t\t\t\tcase r: h = (g - b) / d + (g < b ? 6 : 0); break\r\n\t\t\t\tcase g: h = (b - r) / d + 2; break\r\n\t\t\t\tcase b: h = (r - g) / d + 4; break\r\n\t\t\t}\r\n\t\t\th /= 6\r\n\t\t}\r\n\t\treturn [h, s, l]\r\n\t}\r\n\r\n\r\n\t///////////////////////////////////////////////////////////////////////////\r\n\t////////////////////////////////// UTILS //////////////////////////////////\r\n\t///////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\t// calculated appropriate text color for given background rgb color\r\n\tstatic rgbForeground(r, g, b) {\r\n\t\tvar count = r + g + b\r\n\t\tvar brightness = this.rgbBrightness(r, g, b)\r\n\t\tif (brightness > 140 || count > 450)\r\n\t\t\treturn [0, 0, 0]\r\n\t\t\t//return '#000000'\r\n\t\telse\r\n\t\t\treturn [255, 255, 255]\r\n\t\t\t//return '#FFFFFF'\r\n\t}\r\n\r\n\tstatic rgbBrightness(r, g, b) {\r\n\t\treturn (r * 299 + g * 587 + b * 114) / 1000\r\n\t}\r\n\r\n\t// per ITU-R BT.709\r\n\tstatic rgbLuminance(r, g, b) {\r\n\t\treturn 0.2126 * r + 0.7152 * g + 0.0722 * b\r\n\t}\r\n\r\n\tstatic rgbStrip(string) {\r\n\t\treturn string\r\n\t\t\t.trim()\r\n\t\t\t.split(',')\r\n\t\t\t.map(Number)\r\n\t}\r\n\r\n\tstatic hex(string) {\r\n\t\tstring = string.trim()\r\n\t\tif (string.startsWith('#')) {\r\n\t\t\treturn string\r\n\t\t} else if (string.includes(',')) {\r\n\t\t\tif (string.endsWith(')')) {\r\n\t\t\t\tstring = string.slice(0, -1)\r\n\t\t\t}\r\n\t\t\tif (string.startsWith('rgb(')) {\r\n\t\t\t\tstring = string.slice(4)\r\n\t\t\t}\r\n\t\t\treturn iridescent.rgbToHex(...this.rgbStrip(string))\r\n\t\t}\r\n\t}\r\n\r\n\t///////////////////////////////////////////////////////////////////////////\r\n\t///////////////////////////////// PALETTE /////////////////////////////////\r\n\t///////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\tstatic get names() {\r\n\t\treturn ['red', 'pink', 'purple', 'deep-purple', 'indigo', 'blue', 'light-blue', 'cyan', 'teal', 'green', 'light-green', 'lime', 'yellow', 'amber', 'orange', 'deep-orange', 'brown', 'gray', 'blue-gray']\r\n\t}\r\n\tstatic get shades() {\r\n\t\treturn [100, 300, 500, 700, 900]\r\n\t}\r\n\r\n\tstatic loadPalette() {\r\n\t\tif (this.rgbPalette) return\r\n\t\tvar computed = getComputedStyle(document.body)\r\n\t\tvar rgbPalette = new Map\r\n\t\tvar hslPalette = new Map\r\n\t\tthis.names.forEach(name => {\r\n\t\t\tthis.shades.forEach(shade => {\r\n\t\t\t\tvar rgb = computed\r\n\t\t\t\t\t.getPropertyValue(`--palette-${name}-${shade}-rgb`)\r\n\t\t\t\t\t.trim()\r\n\t\t\t\t\t.split(',')\r\n\t\t\t\t\t.map(Number)\r\n\t\t\t\tvar hsl = this.rgbToHsl(...rgb)\r\n\t\t\t\trgbPalette.set(`${name}-${shade}`, rgb)\r\n\t\t\t\thslPalette.set(`${name}-${shade}`, hsl)\r\n\t\t\t})\r\n\t\t})\r\n\t\tthis.rgbPalette = rgbPalette\r\n\t\tthis.hslPalette = hslPalette\r\n\t}\r\n\r\n\r\n\t///////////////////////////////////////////////////////////////////////////\r\n\t////////////////////////////////// UTILS //////////////////////////////////\r\n\t///////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\tstatic closestPaletteColor(rgb) {\r\n\t\tvar name\r\n\t\tvar diff = 255\r\n\t\tvar hsl = this.rgbToHsl(...rgb)\r\n\t\tvar [h, s, l] = hsl\r\n\t\t//h = Math.round(h * 360)\r\n\t\t//s = Math.round(s * 100)\r\n\t\t//l = Math.round(l * 100)\r\n\t\t//console.log('closest rgb', rgb)\r\n\t\t//console.log('closest hsl', hsl)\r\n\t\t//console.log('hue', Math.round(hsl[0] * 360))\r\n\t\t//console.log('hue', h, s, l)\r\n\t\tthis.hslPalette.forEach((value, colorName) => {\r\n\t\t\tvar d = this.rgbDifference(...value, ...hsl)\r\n\t\t\tif (d < diff) {\r\n\t\t\t\t//console.log(colorName, d)\r\n\t\t\t\tname = colorName\r\n\t\t\t\tdiff = d\r\n\t\t\t}\r\n\t\t})\r\n\t\treturn name\r\n\t}\r\n\r\n\r\n\tstatic applyImageColor(img, target, type = 'primary') {\r\n\t\tvar promise = this.calculateImageColor(img)\r\n\t\treturn promise.then(([background, foreground]) => {\r\n\t\t\t//this.loadPalette()\r\n\t\t\t//var closest = this.closestPaletteColor(background)\r\n\t\t\t//console.log('closest', closest)\r\n\t\t\tthis.setPrimary(target, type, background, foreground)\r\n\t\t})\r\n\t}\r\n\tstatic calculateImageColor(img) {\r\n\t\treturn imgReady(img).then(img => {\r\n\t\t\tvar vibrant = new Vibrant(img)\r\n\t\t\tvar swatch = vibrant.VibrantSwatch\r\n\t\t\tvar background = swatch.rgb\r\n\t\t\tvar foreground = this.calculateForegroundRgb(...background)\r\n\t\t\t//var background = swatch.getHex()\r\n\t\t\t//var foreground = swatch.getTitleTextColor()\r\n\t\t\treturn [background, foreground]\r\n\t\t})\r\n\t}\r\n\r\n\tstatic round(...args) {\r\n\t\tvar [a, b, c] = unpackArgs(args)\r\n\t\treturn [\r\n\t\t\tNumber(a.toFixed(2)),\r\n\t\t\tNumber(b.toFixed(2)),\r\n\t\t\tNumber(c.toFixed(2)),\r\n\t\t]\r\n\t}\r\n\r\n\tstatic rgbDifference(r1, g1, b1, r2, g2, b2) {\r\n\t\tvar sumOfSquares = 0\r\n\t\tsumOfSquares += Math.pow(r1 - r2, 2)\r\n\t\tsumOfSquares += Math.pow(g1 - g2, 2)\r\n\t\tsumOfSquares += Math.pow(b1 - b2, 2)\r\n\t\treturn Math.sqrt(sumOfSquares)\r\n\t}\r\n\r\n\r\n\t///////////////////////////////////////////////////////////////////////////\r\n\t////////////////////////////////// META //////////////////////////////////\r\n\t///////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\tstatic getMetaNode() {\r\n\t\tvar name = 'theme-color'\r\n\t\tvar meta = document.head.querySelector(`meta[name=\"${name}\"]`)\r\n\t\tif (meta) return meta\r\n\t\tmeta = document.createElement('meta')\r\n\t\tmeta.name = name\r\n\t\tdocument.head.appendChild(meta)\r\n\t\treturn meta\r\n\t}\r\n\r\n\t// returns #HEX value from <meta name=\"theme-color\"> tag\r\n\tstatic get meta() {\r\n\t\tvar meta = this.getMetaNode()\r\n\t\treturn meta.content\r\n\t}\r\n\r\n\t// sets rgb() or #HEX value to <meta name=\"theme-color\"> tag\r\n\tstatic set meta(string) {\r\n\t\tstring = string.trim()\r\n\t\tif (string.startsWith('rgb')) {\r\n\t\t\tvar rgb = string.match(/\\d+/g).map(Number)\r\n\t\t\tstring = this.rgbToHex(...rgb)\r\n\t\t\t//console.log(string)\r\n\t\t}\r\n\t\tvar meta = this.getMetaNode()\r\n\t\tif (meta.content !== string)\r\n\t\t\tmeta.content = string\r\n\t}\r\n\r\n\r\n\t///////////////////////////////////////////////////////////////////////////\r\n\t////////////////////////////////// FLEXUS //////////////////////////////////\r\n\t///////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\tstatic setPrimary(target, backgroundRgb, foregroundRgb) {\r\n\t\tthis.setTypedColor(target, 'primary', backgroundRgb, foregroundRgb)\r\n\t}\r\n\tstatic setAccent(target, backgroundRgb, foregroundRgb) {\r\n\t\tthis.setTypedColor(target, 'accent', backgroundRgb, foregroundRgb)\r\n\t}\r\n\tstatic setTypedColor(target, type, backgroundRgb, foregroundRgb) {\r\n\t\ttarget.setAttribute(type, 'custom')\r\n\t\tif (backgroundRgb) {\r\n\t\t\tvar backgroundRgbString = getRgbInsideString(...backgroundRgb)\r\n\t\t\ttarget.style.setProperty(`--${type}-rgb`, backgroundRgbString)\r\n\t\t}\r\n\t\tif (foregroundRgb) {\r\n\t\t\tvar foregroundRgbString = getRgbInsideString(...foregroundRgb)\r\n\t\t\ttarget.style.setProperty(`--${type}-foreground-rgb`, foregroundRgbString)\r\n\t\t}\r\n\t\tif (type === 'accent') {\r\n\t\t\tthis.setTint(target, type, backgroundRgb, foregroundRgb)\r\n\t\t}\r\n\t}\r\n\tstatic setTint(target, type, backgroundRgb, foregroundRgb) {\r\n\t\t// Prevent way too bright colors to be assigned as adaptive accent\r\n\t\t// if given element has/is within light theme\r\n\t\tif (target.matches(':scope[light]') || target.matches('[light] :scope')) {\r\n\t\t\t// colors above 200 are way too bright to be on the white background\r\n\t\t\tif (this.rgbLuminance(...backgroundRgb) > 200) return\r\n\t\t}\r\n\t\t// do not overwrite existing accent value by primary\r\n\t\tif (type === 'primary' && target.style.getPropertyValue(`--tint-rgb`)) {\r\n\t\t\treturn\r\n\t\t}\r\n\t\ttarget.style.setProperty(`--tint-rgb`, backgroundRgb)\r\n\t\ttarget.style.setProperty(`--tint-foreground-rgb`, foregroundRgb)\r\n\t\t// NOTE: if [accent] is changed later to something too bright like pure yellow\r\n\t\t// not only will it not be assigned as adaptive-tint (as expected)\r\n\t\t// but this code does not overwrite residual adaptive color from before\r\n\t}\r\n\tstatic setColor(target, backgroundRgb, foregroundRgb) {\r\n\t\tif (backgroundRgb) {\r\n\t\t\tvar backgroundRgbString = getRgbInsideString(...backgroundRgb)\r\n\t\t\ttarget.style.setProperty(`--background-rgb`, backgroundRgbString)\r\n\t\t}\r\n\t\tif (foregroundRgb) {\r\n\t\t\tvar foregroundRgbString = getRgbInsideString(...foregroundRgb)\r\n\t\t\ttarget.style.setProperty(`--foreground-rgb`, foregroundRgbString)\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n\r\n\r\nfunction getRgbInsideString(r, g, b) {\r\n\treturn `${r}, ${g}, ${b}`\r\n}\r\nfunction getRgbString(r, g, b) {\r\n\treturn `rgb(${r}, ${g}, ${b})`\r\n}\r\n\r\nfunction imgReady(img, callback) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tif (isImgLoaded(img)) {\r\n\t\t\tresolve(img)\r\n\t\t} else {\r\n\t\t\tfunction loadHandler() {\r\n\t\t\t\timg.removeEventListener('load', loadHandler)\r\n\t\t\t\tresolve(img)\r\n\t\t\t}\r\n\t\t\timg.addEventListener('load', loadHandler)\r\n\t\t\tfunction errorHandler() {\r\n\t\t\t\timg.removeEventListener('error', errorHandler)\r\n\t\t\t\treject(img)\r\n\t\t\t}\r\n\t\t\timg.addEventListener('error', errorHandler)\r\n\t\t}\r\n\t})\r\n}\r\n\r\nfunction isImgLoaded(img) {\r\n\treturn img.complete && img.naturalHeight !== 0\r\n}\r\n","import {$, $$, emit, awaitPromises} from 'ganymede'\r\nimport {app} from './appElement'\r\n\r\n\r\nvar head = document.head\r\n\r\nfunction loadStyle(path) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tvar element = document.createElement('link')\r\n\t\telement.rel = 'stylesheet'\r\n\t\telement.type = 'text/css'\r\n\t\telement.href = path\r\n\t\telement.media = 'all'\r\n\t\thead.appendChild(element)\r\n\t\telement.onload = resolve\r\n\t\telement.onerror = reject\r\n\t})\r\n}\r\n\r\nfunction loadScript(path) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tvar element  = document.createElement('script')\r\n\t\telement.src = path\r\n\t\thead.appendChild(element)\r\n\t\telement.onload = resolve\r\n\t\telement.onerror = reject\r\n\t})\r\n}\r\n\r\n\r\nfunction relativePath(path) {\r\n\tvar split = path.split('/')\r\n\tsplit.pop()\r\n\tif (split.length)\r\n\t\tsplit.pop()\r\n\telse\r\n\t\tsplit.push('..')\r\n\treturn (split.join('/') || '.') + '/'\r\n}\r\n\r\nvar rootPath = relativePath(document.currentScript.getAttribute('src'))\r\nexport var path = {\r\n\troot: rootPath,\r\n\tlib: rootPath + 'lib/',\r\n\tcss: rootPath + 'css/',\r\n\telements: rootPath + 'elements/',\r\n\tpolyfills: rootPath + 'polyfills/',\r\n}\r\n\r\nfunction isLoaded(partialPath) {\r\n\treturn Array.from(document.scripts)\r\n\t\t.some(script => script.src.includes(partialPath))\r\n}\r\n\r\n// loading polyfills\r\n\r\nfunction loadPolyfill(src) {\r\n\tvar promise = loadScript(path.root + src)\r\n\tawaitPromises.push(promise)\r\n}\r\n\r\n// core set of custom elements polyfill\r\nif (window.customElements === undefined) {\r\n\tif (!isLoaded('polyfills/custom-elements.min.js'))\r\n\t\tloadPolyfill('polyfills/custom-elements.min.js')\r\n\tif (!isLoaded('polyfills/shadydom.min.js'))\r\n\t\tloadPolyfill('polyfills/shadydom.min.js')\r\n}\r\n\r\n// Edge doesn't have :scope :scope selector \r\nvar scopePoly = false\r\ntry {\r\n\tdocument.querySelector(':scope')\r\n} catch(e) {\r\n\tscopePoly = true\r\n}\r\nif (scopePoly || Element.prototype.after === undefined)\r\n\tif (!isLoaded('polyfills/fx-polyfill.js'))\r\n\t\tloadPolyfill('polyfills/fx-polyfill.js')\r\n\r\n\r\n// basic Element.animate() polyfill\r\nif (Element.prototype.animate === undefined)\r\n\tloadPolyfill('polyfills/web-animations.min.js')\r\n\t//loadPolyfill('node_modules/web-animations-js/web-animations.min.js')\r\n\r\n// extensions of Element.animate() to allow animation clip-path\r\nif (!isLoaded('polyfills/animate-polyfill.js'))\r\n\tloadPolyfill('polyfills/animate-polyfill.js')\r\n\r\n//console.log('loading polyfills')\r\nPromise.all(awaitPromises).then(() => {\r\n\t//console.log('--- polyfills-loaded')\r\n\temit(document, 'polyfills-loaded') // TODO: not firing\r\n\temit(document, 'flexus-ready') // TODO: not firing\r\n})\r\n\r\n\r\n\r\n// utility function for hot-switching theme and loading styles\r\nexport function loadNeon() {\r\n\tvar style = $('[href$=\"flexus-material.css\"]')\r\n\tvar icons = $('[href$=\"flexus-material-icons.css\"]')\r\n\tPromise.all([\r\n\t\tloadStyle(path.css + 'flexus-neon.css'),\r\n\t\tloadStyle(path.css + 'flexus-neon-icons.css'),\r\n\t]).then(() => {\r\n\t\tplatform.material = false\r\n\t\tplatform.neon = true\r\n\t\tapp.removeAttribute('material')\r\n\t\tapp.setAttribute('neon', '')\r\n\t\tif (style) style.remove()\r\n\t\tif (icons) icons.remove()\r\n\t})\r\n}\r\nexport function loadMaterial() {\r\n\tvar style = $('[href$=\"flexus-neon.css\"]')\r\n\tvar icons = $('[href$=\"flexus-neon-icons.css\"]')\r\n\tPromise.all([\r\n\t\tloadStyle(path.css + 'flexus-material.css'),\r\n\t\tloadStyle(path.css + 'flexus-material-icons.css'),\r\n\t]).then(() => {\r\n\t\tplatform.neon = false\r\n\t\tplatform.material = true\r\n\t\tapp.removeAttribute('neon')\r\n\t\tapp.setAttribute('material', '')\r\n\t\tif (style) style.remove()\r\n\t\tif (icons) icons.remove()\r\n\t})\r\n}\r\nexport function swapDesign() {\r\n\tconsole.warn('TODO: flexus.swapDesign() not implemented yet')\r\n}\r\nexport function swapTheme() {\r\n\tvar darks = Array.from($$('[dark]'))\r\n\tvar lights = Array.from($$('[light]'))\r\n\tdarks.forEach(node => {\r\n\t\tnode.removeAttribute('dark')\r\n\t\tnode.setAttribute('light', '')\r\n\t})\r\n\tlights.forEach(node => {\r\n\t\tnode.removeAttribute('light')\r\n\t\tnode.setAttribute('dark', '')\r\n\t})\r\n}\r\n\r\n\r\n/*\r\nfunction loadRipple() {\r\n\tvar styles = Array.from(document.styleSheets)\r\n\t\t\t\t\t.map(style => style.href)\r\n\t\t\t\t\t.filter(href => href && href.includes('flexus'))\r\n\t//var design = 'material'\r\n\tvar design = styles.some(path => path.includes('material')) ? 'material' : 'neon'\r\n\r\n\tif (design === 'material')\r\n\t\tloadScript(path.elements + 'flexus-ripple.js')\r\n\r\n\tdocument.addEventListener('DOMContentLoaded', function() {\r\n\t\tdocument.body.setAttribute(design, '')\r\n\t})\r\n}\r\n*/\r\n","import {app, appElementReady} from './appElement'\r\nimport {platform} from './platform'\r\nimport {iridescent} from './iridescent'\r\nimport {loadNeon, loadMaterial} from './loader'\r\n\r\n\r\n\r\n// unfold UWPs API\r\nif (platform.uwp) {\r\n\tvar ViewManagement = Windows.UI.ViewManagement\r\n\tvar uiViewSettings = ViewManagement.UIViewSettings.getForCurrentView()\r\n\tvar systemNavigationManager = Windows.UI.Core.SystemNavigationManager.getForCurrentView()\r\n\tvar uiSettings = new ViewManagement.UISettings()\r\n\tvar {UserInteractionMode, UIColorType} = ViewManagement\r\n}\r\n\r\n\r\nfunction loadDesign() {\r\n\tif (platform.design === 'material')\r\n\t\tloadMaterial()\r\n\telse\r\n\t\tloadNeon()\r\n\tplatform.designLoaded = true\r\n}\r\n\r\nfunction loadPlatformDesign() {\r\n\tif (platform.windows)\r\n\t\tloadNeon()\r\n\telse\r\n\t\tloadMaterial()\r\n\tplatform.designLoaded = true\r\n}\r\n\r\nfunction detectLoadedDesign() {\r\n\tvar styleSheets = Array.from(document.styleSheets)\r\n\tif (styleSheets.some(s => s.href && s.href.includes('material'))) {\r\n\t\tplatform.material = true\r\n\t\tplatform.design = 'material'\r\n\t\tplatform.designLoaded = true\r\n\t} else if (styleSheets.some(s => s.href && s.href.includes('neon'))) {\r\n\t\tplatform.neon = true\r\n\t\tplatform.design = 'neon'\r\n\t\tplatform.designLoaded = true\r\n\t}\r\n}\r\n\r\nfunction detectNodeDesign(node) {\r\n\tif (node.hasAttribute('material')) {\r\n\t\tplatform.material = true\r\n\t\tplatform.design = 'material'\r\n\t} else if (node.hasAttribute('neon')) {\r\n\t\tplatform.neon = true\r\n\t\tplatform.design = 'neon'\r\n\t}\r\n}\r\n\r\nfunction detectTheme(node) {\r\n\tif (node.hasAttribute('light')) {\r\n\t\tplatform.theme = 'light'\r\n\t} else if (node.hasAttribute('dark')) {\r\n\t\tplatform.theme = 'dark'\r\n\t}\r\n}\r\n\r\n\r\nfunction applyDesignAttrs() {\r\n\tif (platform.neon) {\r\n\t\tapp.setAttribute('neon', '')\r\n\t\tapp.removeAttribute('material')\r\n\t} else {\r\n\t\tapp.setAttribute('material', '')\r\n\t\tapp.removeAttribute('neon')\r\n\t}\r\n}\r\n\r\nfunction applyThemeAttrs() {\r\n\tif (platform.theme === 'dark') {\r\n\t\tapp.setAttribute('dark', '')\r\n\t\tapp.removeAttribute('light')\r\n\t} else {\r\n\t\tapp.setAttribute('light', '')\r\n\t\tapp.removeAttribute('dark')\r\n\t}\r\n}\r\n\r\n// reads 'platform.primary' value which could be either #hex value or name from palette\r\n// if its hex  -> applies the hex to CSS properties\r\n// if its rgb  -> calculates hex from it, applies the hex to CSS properties\r\n// if its name -> calculates hex from it\r\n// then applies hex color to <meta> theme tag (for android chrome)\r\nfunction applyPrimary(fromNode = app) {\r\n\tif (!platform.primary)\r\n\t\treturn\r\n\tvar hex = iridescent.hex(platform.primary)\r\n\tif (hex) {\r\n\t\tapplyHexColorToNode(app, 'primary', hex)\r\n\t} else {\r\n\t\tvar computed = getComputedStyle(fromNode)\r\n\t\tvar color = computed.getPropertyValue('--primary')\r\n\t\thex = iridescent.hex(color)\r\n\t}\r\n\tif (hex)\r\n\t\tiridescent.meta = hex\r\n}\r\n\r\n// TODO - make this work with --tint\r\nfunction applyHexColorToNode(node, type, color) {\r\n\tcolor = color || node.getAttribute(type)\r\n\tif (color.includes(',')) {\r\n\t\tvar backgroundRgb = iridescent.rgbStrip(color)\r\n\t} else {\r\n\t\tvar backgroundRgb = iridescent.hexToRgb(color)\r\n\t}\r\n\tvar foregroundRgb = iridescent.rgbForeground(...backgroundRgb)\r\n\t// Set [primary=\"custom\"] or [accent=\"custom\"] to handle custom colors properly and\r\n\t// assign css custom properties with given color and its computed foreground counterpart\r\n\tiridescent.setTypedColor(node, type, backgroundRgb, foregroundRgb)\r\n}\r\n\r\n\r\nfunction detectUwpTheme() {\r\n\tvar bg = uiSettings.getColorValue(UIColorType.background)\r\n\tvar isDark = (bg.r + bg.g + bg.b) < 382\r\n\tplatform.theme = isDark ? 'dark' : 'light'\r\n\tconsole.log('detectUwpTheme', platform.theme)\r\n}\r\n\r\nfunction detectUwpColor() {\r\n\t// note: UWP only uses single color with name 'accent', it'll be used as the primary for flexus\r\n\tvar color = uiSettings.getColorValue(UIColorType.accent)\r\n\tplatform.primary = `${color.r},${color.g},${color.b}`\r\n}\r\n\r\n\r\n// detect implicitly defined CSS files\r\nif (!platform.design)\r\n\tdetectLoadedDesign()\r\n// load CSS if none was loaded, but defined through JS object\r\nif (platform.design && !platform.designLoaded)\r\n\tloadDesign()\r\n\r\nappElementReady.then(app => {\r\n\r\n\tvar body = document.body\r\n\r\n\t// import design if none was included\r\n\tif (!platform.designLoaded) {\r\n\t\t// find out what style user wants to load\r\n\t\tif (!platform.design)\r\n\t\t\tdetectNodeDesign(app)\r\n\t\tif (!platform.design && body !== app)\r\n\t\t\tdetectNodeDesign(body)\r\n\t\t// load some style but only in non-restrictive (non-cs)p environments\r\n\t\tif (!platform.csp) {\r\n\t\t\tif (platform.design)\r\n\t\t\t\tloadDesign()\r\n\t\t\telse\r\n\t\t\t\tloadPlatformDesign()\r\n\t\t}\r\n\t}\r\n\tapplyDesignAttrs()\r\n\r\n\r\n\tif (!platform.theme)\r\n\t\tdetectTheme(app)\r\n\tif (!platform.theme && body !== app)\r\n\t\tdetectTheme(body)\r\n\tif (!platform.theme) {\r\n\t\tif (platform.uwp) {\r\n\t\t\tdetectUwpTheme()\r\n\t\t\tuiSettings.addEventListener('colorvalueschanged', e => {\r\n\t\t\t\tdetectUwpTheme()\r\n\t\t\t\tapplyThemeAttrs()\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\tapplyThemeAttrs()\r\n\r\n\r\n\tvar primaryElement\r\n\tif (!platform.primary) {\r\n\t\tplatform.primary = app.getAttribute('primary')\r\n\t\tprimaryElement = app\r\n\t}\r\n\tif (!platform.primary && body !== app) {\r\n\t\tplatform.primary = body.getAttribute('primary')\r\n\t\tprimaryElement = body\r\n\t}\r\n\tif (!platform.primary) {\r\n\t\tif (iridescent.meta) {\r\n\t\t\tplatform.primary = iridescent.meta\r\n\t\t} else if (platform.uwp) {\r\n\t\t\tdetectUwpColor()\r\n\t\t\tuiSettings.addEventListener('colorvalueschanged', e => {\r\n\t\t\t\tdetectUwpColor()\r\n\t\t\t\tapplyPrimary()\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\tapplyPrimary(primaryElement)\r\n\r\n/*\r\n\t// read color from meta tag <meta name=\"theme-color\">\r\n\tvar primaryElement = document.querySelector('[primary]:not([primary=\"\"])')\r\n\tvar metaColor = iridescent.meta\r\n\tif (metaColor) {\r\n\t\tapplyHexColorToNode(app, 'primary', metaColor)\r\n\t} else if (primaryElement) {\r\n\t\t// meta[theme-color] was not specified but some [primary] has been.\r\n\t\t// Apply it to meta[theme-color]\r\n\t\tvar color = primaryElement.getAttribute('primary')\r\n\t\tif (!color.startsWith('#')) {\r\n\t\t\tvar computed = getComputedStyle(primaryElement)\r\n\t\t\tcolor = computed.getPropertyValue('--primary').trim()\r\n\t\t}\r\n\t\tiridescent.meta = color\r\n\t}*/\r\n})\r\n\r\n// TODO - make this work with --tint\r\n// apply custom primary colors defined by hex in attribute [primary]\r\nArray.from(document.querySelectorAll('[primary^=\"#\"]')).forEach(node => {\r\n\tapplyHexColorToNode(node, 'primary')\r\n})\r\n\r\n// TODO - make this work with --tint and calculate \r\n// apply custom accent colors defined by hex in attribute [accent]\r\nArray.from(document.querySelectorAll('[accent^=\"#\"]')).forEach(node => {\r\n\tapplyHexColorToNode(node, 'accent')\r\n})\r\n","import {platform} from './platform'\r\nimport {app, appElementReady} from './appElement'\r\n\r\n\r\nexport var effectSuppresion = {\r\n\tbatteryLevel: 20,\r\n\tminCpuCores: 2,\r\n}\r\n\r\nvar batteryWise = false\r\nvar cpuWise = navigator.hardwareConcurrency < effectSuppresion.minCpuCores\r\n\r\nfunction update() {\r\n\tif (batteryWise || cpuWise) {\r\n\t\tconsole.log('TODO: disable effects')\r\n\t\tapp.setAttribute('noeffects', '')\r\n\t} else {\r\n\t\tconsole.log('TODO: enable effects')\r\n\t\tapp.removeAttribute('noeffects')\r\n\t}\r\n}\r\n\r\nfunction batteryUpdated(level, charging) {\r\n\tbatteryWise = !charging && level <= effectSuppresion.batteryLevel\r\n\tupdate()\r\n}\r\n\r\n// TODO: detect battery status and disable acrylic and other expensive effects\r\n// TODO: detect old and slow devices (cpu cores, available memory)\r\n/*if (platform.uwp) {\r\n\tvar Battery = Windows.Devices.Power.Battery\r\n\tvar BatteryStatus = Windows.System.BatteryStatus\r\n\tvar aggBattery = Battery.aggregateBattery\r\n\tvar report = aggBattery.getReport()\r\n\tif (report.status !== BatteryStatus.notPresent) {\r\n\t\tvar check = () => {\r\n\t        var max = report.fullChargeCapacityInMilliwattHours\r\n\t        var value = report.remainingCapacityInMilliwattHours\r\n\t        var level = Math.round((value / max) * 100)\r\n\t\t\tbatteryUpdated(level, report.status === BatteryStatus.charging)\r\n\t\t}\r\n\t\tcheck()\r\n\t}\r\n}*/\r\n\r\n// web platform outside any app runtime might have W3C Battery API available\r\nif (platform.web && navigator.getBattery) {\r\n\tappElementReady\r\n\t\t.then(navigator.getBattery())\r\n\t\t.then(battery => {\r\n\t\t\tvar check = () => batteryUpdated(battery.level, battery.charging)\r\n\t\t\tbattery.addEventListener('chargingchange', check)\r\n\t\t\tbattery.addEventListener('levelchange', check)\r\n\t\t})\r\n}\r\n","import {scheduleEvent} from 'ganymede'\r\n\r\n/*\r\n// create and inject multipurpose overlay\r\nexport var overlay = document.createElement('div')\r\noverlay.id = 'fx-overlay'\r\ndocument.addEventListener('DOMContentLoaded', e => {\r\n\tdocument.body.insertBefore(overlay, document.body.childNodes[0])\r\n})\r\n*/\r\n\r\n// creates <style> for adding additional custom rules of imported elements \r\nvar styleEl = document.createElement('style')\r\nstyleEl.id = 'fx-addon-styles'\r\ndocument.head.appendChild(styleEl)\r\nexport var styleSheet = styleEl.sheet\r\n\r\nexport function addReadyAnimation(tagName) {\r\n\tstyleSheet.addRule(`${tagName}:not([ready])`, 'opacity: 0 !important', 0)\r\n\tstyleSheet.addRule(`${tagName}[ready]`, 'animation: 200ms fadein', 0)\r\n}\r\n\r\n\r\n// traverse node's parents until condition is met\r\nexport function traverse(startNode, condition) {\r\n\tvar node = startNode\r\n\twhile (node != null) {\r\n\t\tif (condition(node)) break\r\n\t\tnode = node.parentElement\r\n\t}\r\n\treturn node\r\n}\r\nexport function traverseValue(startNode, condition) {\r\n\tvar node = startNode\r\n\tvar result\r\n\twhile (node) {\r\n\t\tresult = condition(node)\r\n\t\tif (result !== undefined && result !== null)\r\n\t\t\treturn result\r\n\t\tnode = node.parentElement\r\n\t}\r\n}\r\n\r\nexport function runAll(array) {\r\n\tfor (var i = 0; i < array.length; i++)\r\n\t\tarray[i]()\r\n}\r\n\r\nexport function clamp(num, min, max) {\r\n\treturn num < min ? min : num > max ? max : num\r\n}\r\n\r\nexport function mapRange(num, in_min, in_max, out_min, out_max) {\r\n\treturn (num - in_min) * (out_max - out_min) / (in_max - in_min) + out_min\r\n}\r\n\r\nexport function isTouchEvent(e) {\r\n\tif (e.sourceCapabilities && e.sourceCapabilities.firesTouchEvents)\r\n\t\treturn true\r\n\tif (e.pointerType && e.pointerType == 'touch')\r\n\t\treturn true\r\n\treturn false\r\n}\r\n\r\nif (!Element.prototype.matches) {\r\n\tElement.prototype.matches = \r\n\t\tElement.prototype.matchesSelector || \r\n\t\tElement.prototype.mozMatchesSelector ||\r\n\t\tElement.prototype.msMatchesSelector || \r\n\t\tElement.prototype.oMatchesSelector || \r\n\t\tElement.prototype.webkitMatchesSelector ||\r\n\t\tfunction(s) {\r\n\t\t\tvar matches = (this.document || this.ownerDocument).querySelectorAll(s)\r\n\t\t\tvar i = matches.length\r\n\t\t\twhile (--i >= 0 && matches.item(i) !== this) {}\r\n\t\t\treturn i > -1\r\n\t\t}\r\n}\r\n\r\n\r\n// todo: deprecate?\r\nexport function draggable(ClassOrElement, name = '', handlersSource = ClassOrElement, bindingTarget = handlersSource, orientation = 'horizontal') {\r\n\tvar handlers = name instanceof Array ? name : [`on${name}DragStart`, `on${name}DragMove`, `on${name}DragEnd`]\r\n\r\n\tif (ClassOrElement instanceof Element) {\r\n\t\t// This means drggable used as a function (in some element created/ready callback or something)\r\n\t\t// and is used to handle dragging shadow dom sub element. Name as well as source was given \r\n\t\t//handlersSource = ClassOrElement\r\n\t\tattachToInstance.call(ClassOrElement)\r\n\t\t// todo. make function like scheduleEvent but for non custom elements (sub elements in shadow tree) - because of killbacks\r\n\t} else {\r\n\t\t// This branch means draggable is used as class decorator to add general pointer handler.\r\n\t\t// methods come from Class prototype and will be bound and attached to element\r\n\t\thandlersSource = ClassOrElement.prototype\r\n\t\tscheduleEvent(ClassOrElement, 'created', attachToInstance)\r\n\t}\r\n\r\n\r\n\tfunction attachToInstance() {\r\n\t\tvar startHandler, moveHandler, endHandler\r\n\t\tvar bindTo = bindingTarget || this\r\n\t\tif (handlersSource[handlers[0]]) startHandler = handlersSource[handlers[0]].bind(bindTo)\r\n\t\tif (handlersSource[handlers[1]]) moveHandler  = handlersSource[handlers[1]].bind(bindTo)\r\n\t\tif (handlersSource[handlers[2]]) endHandler   = handlersSource[handlers[2]].bind(bindTo)\r\n\r\n\t\t// touch-action tells browser what direction is not handled by JS and is left to browser to handle\r\n\t\tif (orientation === 'vertical') {\r\n\t\t\t// browser natively scrolls X axis and JS consumes and takes care of Y axis events\r\n\t\t\tthis.setAttribute('touch-action', 'pan-x')\r\n\t\t} else if (orientation === 'horizontal') {\r\n\t\t\t// browser natively scrolls Y axis and JS consumes and takes care of X axis events\r\n\t\t\tthis.setAttribute('touch-action', 'pan-y')\r\n\t\t}\r\n\r\n\t\tthis.addEventListener('pointerdown', onDragStart)\r\n\t\tbindTo.registerKillback(() => this.removeEventListener('pointerdown', onDragStart))\r\n\r\n\t\tfunction onDragStart(e) {\r\n\t\t\te.stopPropagation()\r\n\t\t\tif (e.pointerType == 'mouse')\r\n\t\t\t\te.preventDefault()\r\n\t\t\tdocument.addEventListener('pointermove', onDragMove)\r\n\t\t\tdocument.addEventListener('pointerup', onDragEnd)\r\n\t\t\tdocument.addEventListener('pointercancel', onDragEnd)\r\n\t\t\tif (startHandler) startHandler(e)\r\n\t\t}\r\n\t\tfunction onDragMove(e) {\r\n\t\t\te.stopPropagation()\r\n\t\t\te.preventDefault()\r\n\t\t\tif (moveHandler) moveHandler(e)\r\n\t\t}\r\n\t\tfunction onDragEnd(e) {\r\n\t\t\te.stopPropagation()\r\n\t\t\te.preventDefault()\r\n\t\t\tdocument.removeEventListener('pointermove', onDragMove)\r\n\t\t\tdocument.removeEventListener('pointerup', onDragEnd)\r\n\t\t\tdocument.removeEventListener('pointercancel', onDragEnd)\r\n\t\t\tif (endHandler) endHandler(e)\r\n\t\t}\r\n\t}\r\n}","import {traverse} from './utils'\r\n\r\n\r\nfunction pythagorean(a, b) {\r\n\treturn Math.sqrt(a*a + b*b)\r\n}\r\n\r\nfunction durationByDistance(distance) {\r\n\t// 200 + 13x^0.5\r\n\t//return 200 + 12 * Math.sqrt(distance)\r\n\treturn 100 + 11 * Math.sqrt(distance) || 0\r\n}\r\n\r\nfunction eventPositionInContainer(e, container) {\r\n\tvar containerBbox = container.getBoundingClientRect()\r\n\tvar x = e.x - containerBbox.left\r\n\tvar y = e.y - containerBbox.top\r\n\tvar width = containerBbox.width\r\n\tvar height = containerBbox.height\r\n\t//console.log(x, y, width, height)\r\n\tif (x > width)  x = width\r\n\tif (y > height) y = height\r\n\t//console.log(x, y, width, height)\r\n\treturn {x, y, width, height}\r\n}\r\nfunction nodePositionInContainer(node, container) {\r\n\tvar nodeBbox = node.getBoundingClientRect()\r\n\tvar containerBbox = container.getBoundingClientRect()\r\n\tvar x = nodeBbox.left - containerBbox.left + (nodeBbox.width / 2)\r\n\tvar y = nodeBbox.top - containerBbox.top + (nodeBbox.height / 2)\r\n\tvar width = containerBbox.width\r\n\tvar height = containerBbox.height\r\n\tif (x > width)  x = width\r\n\tif (y > height) y = height\r\n\treturn {x, y, width, height}\r\n}\r\n\r\nexport var animation = {\r\n\r\n\tdurationByDistance,\r\n\r\n\r\n\tcircle: {\r\n\r\n\t\t_calculate(element, from) {\r\n\t\t\t//var x = e.layerX\r\n\t\t\t//var y = e.layerY\r\n\t\t\tvar position\r\n\t\t\tif (typeof from === 'string') {\r\n\t\t\t\tposition = from\r\n\t\t\t\tvar x = 0\r\n\t\t\t\tvar y = 0\r\n\t\t\t\tvar width = element.offsetWidth\r\n\t\t\t\tvar height = element.offsetHeight\r\n\t\t\t} else if (from instanceof Element) {\r\n\t\t\t\tvar {x, y, width, height} = nodePositionInContainer(from, element)\r\n\t\t\t\tposition = `${x}px ${y}px`\r\n\t\t\t} else if (from instanceof Event) {\r\n\t\t\t\tvar {x, y, width, height} = eventPositionInContainer(from, element)\r\n\t\t\t\tposition = `${x}px ${y}px`\r\n\t\t\t}\r\n\t\t\tvar a = (x > width / 2)  ? x : width - x\r\n\t\t\tvar b = (y > height / 2) ? y : height - y\r\n\t\t\t// distance to the furthest corner\r\n\t\t\tvar distance = pythagorean(a, b)\r\n\t\t\treturn {position, distance}\r\n\t\t},\r\n\r\n\t\t_setup(element, from, duration) {\r\n\t\t\tif (from) {\r\n\t\t\t\tvar {position, distance} = this._calculate(element, from)\r\n\t\t\t} else {\r\n\t\t\t\tvar position = 'center'\r\n\t\t\t\tvar distance = pythagorean(element.offsetWidth, element.offsetHeight)\r\n\t\t\t}\r\n\t\t\tif (!duration)\r\n\t\t\t\tduration = durationByDistance(distance)\r\n\t\t\treturn {position, distance, duration}\r\n\t\t},\r\n\r\n\t\tshow(element, from, duration) {\r\n\t\t\t//console.log('from', from)\r\n\t\t\tvar {position, distance, duration} = this._setup(element, from, duration)\r\n\t\t\t//console.log('position', position)\r\n\t\t\t//console.log('distance', distance)\r\n\t\t\t//console.log('duration', duration)\r\n\t\t\t// reset display from hidden to previous.\r\n\t\t\t// empty string gets default css value (could be flex) rather than block\r\n\t\t\telement.style.visibility = ''\r\n\t\t\tvar finished = element.animate([\r\n\t\t\t\t{clipPath: `circle(0px at ${position})`},\r\n\t\t\t\t{clipPath: `circle(${distance}px at ${position})`}\r\n\t\t\t], {\r\n\t\t\t\tduration,\r\n\t\t\t\teasing: 'ease-in-out'\r\n\t\t\t}).finished\r\n\t\t\treturn finished\r\n\t\t},\r\n\r\n\t\thide(element, from, duration) {\r\n\t\t\tvar {position, distance, duration} = this._setup(element, from, duration)\r\n\t\t\t// reset display from hidden to previous.\r\n\t\t\t// empty string gets default css value (could be flex) rather than block\r\n\t\t\tvar finished = element.animate([\r\n\t\t\t\t{clipPath: `circle(${distance}px at ${position})`},\r\n\t\t\t\t{clipPath: `circle(0px at ${position})`}\r\n\t\t\t], {\r\n\t\t\t\tduration,\r\n\t\t\t\teasing: 'ease-in-out'\r\n\t\t\t}).finished\r\n\t\t\tfinished.then(() => element.style.visibility = 'hidden')\r\n\t\t\treturn finished\r\n\t\t},\r\n\r\n\t},\r\n\r\n\r\n\tfade: {\r\n\r\n\t\tin(element, duration = 140) {\r\n\t\t\t// reset display from hidden to previous.\r\n\t\t\t// empty string gets default css value (could be flex) rather than block\r\n\t\t\t\telement.style.visibility = ''\r\n\t\t\treturn element.animate([\r\n\t\t\t\t{opacity: 0},\r\n\t\t\t\t{opacity: 1}\r\n\t\t\t], duration).finished\r\n\t\t},\r\n\r\n\t\tout(element, duration = 140) {\r\n\t\t\tvar finished = element.animate([\r\n\t\t\t\t{opacity: 1},\r\n\t\t\t\t{opacity: 0}\r\n\t\t\t], duration).finished\r\n\t\t\tfinished.then(() => element.style.visibility = 'hidden')\r\n\t\t\treturn finished\r\n\t\t},\r\n/*\r\n\t\toutAndKeepDisplayed(element) {\r\n\t\t\treturn new Promise(resolve => {\r\n\t\t\t\telement.animate([\r\n\t\t\t\t\t{opacity: 1},\r\n\t\t\t\t\t{opacity: 0}\r\n\t\t\t\t], 100).onfinish = () => {\r\n\t\t\t\t\telement.style.opacity = 1 // to be removed when animate-polyfill fixed TODO\r\n\t\t\t\t\t//element.style.display = 'none'\r\n\t\t\t\t\tresolve()\r\n\t\t\t\t}\t\r\n\t\t\t})\r\n\t\t}\r\n*/\r\n\t},\r\n\r\n\r\n\tslideIn: {\r\n\r\n\t\tleft(element) {\r\n\t\t\t// reset display from hidden to previous.\r\n\t\t\t// empty string gets default css value (could be flex) rather than block\r\n\t\t\telement.style.visibility = ''\r\n\t\t\tvar animation = element.animate([\r\n\t\t\t\t{opacity: 0, transform: 'translate3d(10%,0,0)'},\r\n\t\t\t\t{opacity: 1, transform: 'translate3d(0%,0,0)'}\r\n\t\t\t], {\r\n\t\t\t\tduration: 100, // ???\r\n\t\t\t\teasing: 'ease-out' // ???\r\n\t\t\t})\r\n\t\t\treturn animation.finished\r\n\t\t},\r\n\r\n\t\tright(element) {\r\n\t\t\t// reset display from hidden to previous.\r\n\t\t\t// empty string gets default css value (could be flex) rather than block\r\n\t\t\telement.style.visibility = ''\r\n\t\t\tvar animation = element.animate([\r\n\t\t\t\t{opacity: 0, transform: 'translate3d(-10%,0,0)'},\r\n\t\t\t\t{opacity: 1, transform: 'translate3d(0%,0,0)'}\r\n\t\t\t], {\r\n\t\t\t\tduration: 100, // ???\r\n\t\t\t\teasing: 'ease-out' // ???\r\n\t\t\t})\r\n\t\t\treturn animation.finished\r\n\t\t}\r\n\r\n\t},\r\n\r\n\r\n\tslideOut: {\r\n\r\n\t\tleft(element) {\r\n\t\t\tvar animation = element.animate([\r\n\t\t\t\t{opacity: 1, transform: 'translate3d(0%,0,0)'},\r\n\t\t\t\t{opacity: 0, transform: 'translate3d(-10%,0,0)'}\r\n\t\t\t], {\r\n\t\t\t\tduration: 100, // ???\r\n\t\t\t\teasing: 'ease-out' // ???\r\n\t\t\t})\r\n\t\t\tanimation.finished.then(() => element.style.visibility = 'hidden')\r\n\t\t\treturn animation.finished\r\n\t\t},\r\n\r\n\t\tright(element) {\r\n\t\t\tvar animation = element.animate([\r\n\t\t\t\t{opacity: 1, transform: 'translate3d(0%,0,0)'},\r\n\t\t\t\t{opacity: 0, transform: 'translate3d(10%,0,0)'}\r\n\t\t\t], {\r\n\t\t\t\tduration: 100, // ???\r\n\t\t\t\teasing: 'ease-out' // ???\r\n\t\t\t})\r\n\t\t\tanimation.finished.then(() => element.style.visibility = 'hidden')\r\n\t\t\treturn animation.finished\r\n\t\t}\r\n\r\n\t},\r\n\r\n\trotateIcon: {\r\n\r\n\t\tshow(element) {\r\n\t\t\t_.forEach(element.children, element => {\r\n\t\t\t\tif (element.localName == 'button' && element.hasAttribute('icon')) {\r\n\t\t\t\t\tanim(element)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tfunction anim(element) {\r\n\t\t\t\telement.animate([\r\n\t\t\t\t\t{transform: 'rotate(-180deg)'},\r\n\t\t\t\t\t{transform: 'rotate(0deg)'}\r\n\t\t\t\t], {\r\n\t\t\t\t\tduration: 300,\r\n\t\t\t\t\teasing: 'ease-in-out'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\thide(element) {\r\n\t\t\t_.forEach(element.children, element => {\r\n\t\t\t\tif (element.localName == 'button' && element.hasAttribute('icon')) {\r\n\t\t\t\t\tanim(element)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tfunction anim(element) {\r\n\t\t\t\telement.animate([\r\n\t\t\t\t\t{transform: 'rotate(0deg)'},\r\n\t\t\t\t\t{transform: 'rotate(180deg)'}\r\n\t\t\t\t], {\r\n\t\t\t\t\tduration: 300,\r\n\t\t\t\t\teasing: 'ease-in-out'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tswapContent(element, distance = 16, duration = 240) {\r\n\t\tvar halfDuration = duration / 2\r\n\t\tvar visibleState = {\r\n\t\t\topacity: 1,\r\n\t\t\ttransform: `translate3d(0px, 0, 0)`\r\n\t\t}\r\n\t\tvar slideOutState = {\r\n\t\t\topacity: 0,\r\n\t\t\ttransform: `translate3d(${-distance}px, 0, 0)`\r\n\t\t}\r\n\t\tvar slideInState = {\r\n\t\t\topacity: 0,\r\n\t\t\ttransform: `translate3d(${distance}px, 0, 0)`\r\n\t\t}\r\n\t\telement.style.transitionDelay = duration + 'ms'\r\n\t\treturn new Promise(resolve => {\r\n\t\t\telement\r\n\t\t\t\t.animate([visibleState, slideOutState], halfDuration)\r\n\t\t\t\t.onfinish = () => {\r\n\t\t\t\t\tresolve()\r\n\t\t\t\t\telement.style.transitionDelay = ''\r\n\t\t\t\t\telement.style.transition = 'none'\r\n\t\t\t\t\telement\r\n\t\t\t\t\t\t.animate([slideInState, visibleState], halfDuration)\r\n\t\t\t\t\t\t.onfinish = () => {\r\n\t\t\t\t\t\t\telement.style.transition = ''\r\n\t\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t})\r\n\t},\r\n\r\n\r\n\tslideX: {\r\n\t\tshow(element, from, to, duration, easing) {\r\n\t\t\telement.style.display = ''\r\n\t\t\telement.animate([{\r\n\t\t\t\ttransform: `translate3d(${from}, 0px, 0)`\r\n\t\t\t}, {\r\n\t\t\t\ttransform: `translate3d(${to}, 0px, 0)`\r\n\t\t\t}], duration)\r\n\t\t},\r\n\t\thide(element, from, to, duration, easing) {\r\n\t\t\telement.animate([{\r\n\t\t\t\ttransform: `translate3d(${from}, 0px, 0)`\r\n\t\t\t}, {\r\n\t\t\t\ttransform: `translate3d(${to}, 0px, 0)`\r\n\t\t\t}], duration).onfinish = e => {\r\n\t\t\t\telement.style.display = 'none'\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\r\n\r\n\t// experimental\r\n\ttransition(element, values, keep, duration) {\r\n\t\tvar from = {}\r\n\t\tvar to = {}\r\n\t\tfor (let key in values) {\r\n\t\t\tfrom[key] = values[key][0]\r\n\t\t\tto[key] = values[key][1]\r\n\t\t}\r\n\t\tif (typeof duration !== 'number') {\r\n\t\t\tif (duration === undefined)\r\n\t\t\t\tvar prop = Object.keys(values)[0]\r\n\t\t\telse\r\n\t\t\t\tvar prop = duration\r\n\t\t\tvar distance = Math.abs(parseInt(from[prop]) - parseInt(to[prop]))\r\n\t\t\tduration = durationByDistance(distance)\r\n\t\t}\r\n\t\tvar player = element.animate([from, to], {\r\n\t\t\tduration,\r\n\t\t\teasing: 'ease-in-out'\r\n\t\t})\r\n\t\tif (keep)\r\n\t\t\tplayer.finished.then(() => {\r\n\t\t\t\tfor (let key in to) {\r\n\t\t\t\t\telement.style[key] = to[key]\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\treturn player.finished\r\n\t}\r\n\r\n}\r\n","import {scheduleEvent} from 'ganymede'\r\n\r\n\r\n\r\n\r\n\r\nif (window.ResizeObserver) {\r\n\tvar ro = new ResizeObserver(entries => {\r\n\t\tfor (let entry of entries) {\r\n\t\t\tif (entry.target.onresize)\r\n\t\t\t\tentry.target.onresize(entry)\r\n\t\t\tif (entry.target.onResize)\r\n\t\t\t\tentry.target.onResize(entry)\r\n\t\t}\r\n\t})\r\n}\r\n\r\nfunction setupWatchElement(element) {\r\n\tvar obj = document.createElement('object')\r\n\tobj.type = 'text/html'\r\n\tobj.data = 'about:blank'\r\n\tobj.style.display = 'block'\r\n\tobj.style.position = 'absolute'\r\n\tobj.style.top = 0\r\n\tobj.style.right = 0\r\n\tobj.style.bottom = 0\r\n\tobj.style.left = 0\r\n\tobj.style.height = '100%'\r\n\tobj.style.width = '100%'\r\n\tobj.style.overflow = 'hidden'\r\n\tobj.style.pointerEvents = 'none'\r\n\tobj.style.zIndex = -1\r\n\telement.style.position = 'relative'\r\n\telement.appendChild(obj)\r\n\treturn obj\r\n}\r\n\r\nfunction watchElement(obj, listener) {\r\n\tobj.onload = e => {\r\n\t\tobj.contentDocument.defaultView.addEventListener('resize', listener)\r\n\t\t//obj.contentDocument.defaultView.addEventListener('resize', e => {\r\n\t\t//\tif (resizeRAF) cancelAnimationFrame(resizeRAF)\r\n\t\t//\tresizeRAF = requestAnimationFrame(listener)\r\n\t\t//})\r\n\t}\r\n\treturn () => obj.contentDocument.defaultView.removeEventListener('resize', listener)\r\n}\r\n\r\nvar resizeRAF\r\nfunction diyDetector(target, listener) {\r\n\tvar object\r\n\tvar watchesGlobalResize\r\n\tvar listenTarget\r\n\tfunction resizeCallback() {\r\n\t\tconsole.log('resize')\r\n\t\tif (resizeRAF) cancelAnimationFrame(resizeRAF)\r\n\t\tresizeRAF = requestAnimationFrame(listener)\r\n\t}\r\n\tfunction listenObjectView() {\r\n\t\tlistenTarget = object.contentDocument.defaultView\r\n\t\tlistenTarget.addEventListener('resize', resizeCallback)\r\n\t}\r\n\tfunction start() {\r\n\t\tif (target.offsetWidth === window.innerWidth) {\r\n\t\t\twatchesGlobalResize = true\r\n\t\t\tlistenTarget = window\r\n\t\t\tlistenTarget.addEventListener('resize', resizeCallback)\r\n\t\t} else if (watchesGlobalResize === undefined) {\r\n\t\t\t// Target element is not the exact width of window and custom inset object is used (for the first time).\r\n\t\t\twatchesGlobalResize = false\r\n\t\t\tobject = setupWatchElement(target)\r\n\t\t\tobject.onload = listenObjectView\r\n\t\t} else if (watchesGlobalResize === false) {\r\n\t\t\t// Target element is not the exact width of window and custom inset object is used (repeatedly).\r\n\t\t\twatchesGlobalResize = false\r\n\t\t\tlistenObjectView()\r\n\t\t}\r\n\t}\r\n\r\n\tstart()\r\n\tdocument.addEventListener('formfactor-update', e => {\r\n\t\tconsole.log('formfactor-update')\r\n\t\tlistenTarget.removeEventListener('resize', resizeCallback)\r\n\t\tstart()\r\n\t})\r\n}\r\n\r\nfunction setupDetector(target) {\r\n\tif (window.ResizeObserver) {\r\n\t\tro.observe(target)\r\n\t\t//ro.unobserve(target)\r\n\t} else {\r\n\t\tdiyDetector(target, () => {\r\n\t\t\t//console.log('resize')\r\n\t\t})\r\n\t}\r\n}\r\n\r\nexport function resizeDetector(ClassOrCondition) {\r\n\tvar condition\r\n\tfunction init(Class) {\r\n\t\tscheduleEvent(Class, 'created', function() {\r\n\t\t\tif (condition && !condition(this)) return\r\n\t\t\tsetupDetector(this)\r\n\t\t})\r\n\t}\r\n\tif (ClassOrCondition.name) {\r\n\t\tinit(ClassOrCondition)\r\n\t} else {\r\n\t\tcondition = ClassOrCondition\r\n\t\treturn init\r\n\t}\r\n}","export function rafThrottle(callback) {\r\n\tvar latestArg\r\n\tvar running = false\r\n\tfunction run() {\r\n\t\trunning = false\r\n\t\tcallback(latestArg)\r\n\t}\r\n\treturn arg => {\r\n\t\tif (running === true) return\r\n\t\trunning = true\r\n\t\tlatestArg = arg\r\n\t\trequestAnimationFrame(run)\r\n\t}\r\n}\r\n\r\n/*\r\nexport class RenderManager {\r\n\r\n\ttemporary = []\r\n\tlooping = []\r\n\r\n\trequests = new Map\r\n\trafid = 0\r\n\r\n\tget running() {\r\n\t\treturn this.rafid != 0\r\n\t}\r\n\r\n\tconstructor() {\r\n\t\tthis.frame = this.frame.bind(this)\r\n\t}\r\n\r\n\t// register repeated resusable renderer with a name and use it to start/stop\r\n\tregister(name, renderer) {\r\n\t\tthis.requests.set(name, renderer)\r\n\t}\r\n\tstart(name) {\r\n\t\tconsole.log('start', name)\r\n\t\tvar renderer = this.requests.get(name)\r\n\t\tvar rendererIndex = this.looping.indexOf(renderer)\r\n\t\t// add request to the list of looping requests and start animation frame\r\n\t\tif (rendererIndex == -1) {\r\n\t\t\tthis.looping.push(renderer)\r\n\t\t\tif (!this.rafid) {\r\n\t\t\t\tthis.frame()\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tstop(name) {\r\n\t\tconsole.log('stop', name)\r\n\t\t// remove request from list of looping requests\r\n\t\tvar renderer = this.requests.get(name)\r\n\t\tvar rendererIndex = this.looping.indexOf(renderer)\r\n\t\tif (rendererIndex != -1) {\r\n\t\t\tthis.looping.splice(rendererIndex, 1)\r\n\t\t}\r\n\t\t// if no other requests, stop\r\n\t\tif (this.looping.length == 0 && this.rafid) {\r\n\t\t\tthis.cancel()\r\n\t\t}\r\n\t}\r\n\r\n\tonce(fn) {\r\n\t\t//console.log('once !includes', !this.temporary.includes(fn), this.temporary)\r\n\t\tif (!this.temporary.includes(fn)) {\r\n\t\t\tthis.temporary.push(fn)\r\n\t\t\tif (!this.running) {\r\n\t\t\t\tthis.request()\r\n\t\t\t}\r\n\t\t}\r\n\t\t//this.start()\r\n\t}\r\n\tprevent(fn) {\r\n\t\tif (this.temporary.includes(fn)) {\r\n\t\t\tremoveFromArray(this.temporary, fn)\r\n\t\t}\r\n\t}\r\n\r\n\trequest() {\r\n\t\tthis.rafid = requestAnimationFrame(this.frame)\r\n\t}\r\n\r\n\tcancel() {\r\n\t\tcancelAnimationFrame(this.rafid)\r\n\t\tthis.rafid = 0\r\n\t}\r\n\r\n\tframe() {\r\n\t\t//console.log('frame this.looping', this.looping)\r\n\t\tif (this.looping.length) {\r\n\t\t\t// request another frame\r\n\t\t\tthis.request()\r\n\t\t} else {\r\n\t\t\tthis.rafid = 0\r\n\t\t}\r\n\t\tif (this.looping.length) {\r\n\t\t\t//this.rafid = requestAnimationFrame(this.frame)\r\n\t\t\t// if theres something to render, render it\r\n\t\t\tfor (var i = 0; i < this.looping.length; i++) {\r\n\t\t\t\tconsole.log(this.looping[i])\r\n\t\t\t\tthis.looping[i]()\r\n\t\t\t}\r\n\t\t}\r\n\t\t// render all one-off functions\r\n\t\tif (this.temporary.length) {\r\n\t\t\twhile (this.temporary.length) {\r\n\t\t\t\tthis.temporary.shift()()\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n}\r\n*/","import ganymede from 'ganymede'\r\nimport {reflect, observe, emit} from 'ganymede'\r\nimport {platform} from './platform'\r\n\r\n\r\nvar screensizes = ['s', 'm', 'l']\r\n\r\nconst SMALL  = 's'\r\nconst MEDIUM = 'm'\r\nconst LARGE  = 'l'\r\n\r\nexport const SCREENSIZE = {SMALL, MEDIUM, LARGE}\r\n\r\nvar screenSizeFlags = {\r\n\ts:   0b001,\r\n\tm:   0b010,\r\n\tl:   0b100,\r\n\tgts: 0b110,\r\n\tltl: 0b011,\r\n}\r\n\r\nexport function matchFormFactorDef(def) {\r\n\tif (screenSizeFlags[def] === undefined) {\r\n\t\t// custom value applicable for all formfactors\r\n\t\treturn true\r\n\t} else {\r\n\t\t// query to enable only for certain formfactors\r\n\t\tdef = screenSizeFlags[def]\r\n\t\tvar ss = screenSizeFlags[platform.screensize]\r\n\t\treturn (def & ss) > 0\r\n\t}\r\n}\r\n\r\n// helpers for transforming numbers into breakpoint queries\r\nvar makeFirstQuery = value => `(max-width: ${value}px)`\r\nvar makeLastQuery = value => `(min-width: ${value}px)`\r\nvar makeStepQuery = (a, b) => `${makeLastQuery(a)} and ${makeFirstQuery(b)}`\r\n\r\n// transorms array of breakpoint numbers into queries describing these breakpoints\r\nfunction makeBreakpointQueries(breakpoints) {\r\n\t//breakpoints = breakpoints.map(Number)\r\n\tbreakpoints = breakpoints\r\n\t\t.map(num => parseInt(num))\r\n\t\t.filter(num => num) // for now just filter out empty breakpoints\r\n\tvar queries = [makeFirstQuery(breakpoints[0])]\r\n\tvar lastIndex = breakpoints.length - 1\r\n\tif (lastIndex > 0) {\r\n\t\tfor (var i = 0; i < lastIndex; i++)\r\n\t\t\tqueries.push(makeStepQuery(breakpoints[i], breakpoints[i + 1]))\r\n\t}\r\n\tqueries.push(makeLastQuery(breakpoints[lastIndex]))\r\n\treturn queries\r\n}\r\n\r\nfunction registerQueries(queries, onAlways, onUpdate, attrName, attrValues = []) {\r\n\treturn queries.map((query, i) => {\r\n\t\treturn registerQuery(query, onAlways, onUpdate, attrName, attrValues[i], i)\r\n\t})\r\n}\r\n\r\nfunction registerQuery(query, onAlways, onUpdate, attrName, attrValue = '', i = -1) {\r\n\tvar mql = window.matchMedia(query)\r\n\tvar listener = () => {\r\n\t\tonAlways(mql, i)\r\n\t\tonUpdate(mql, i)\r\n\t}\r\n\tvar killback = () => mql.removeListener(listener)\r\n\tmql.addListener(listener)\r\n\tmql.attrName = attrName\r\n\tmql.attrVal = attrValue\r\n\tonAlways(mql, i)\r\n\treturn killback\r\n}\r\n\r\n\r\nvar documentReady = false\r\nvar htmlNode\r\nganymede.ready.then(() => {\r\n\tdocumentReady = true\r\n\thtmlNode = document.body.parentElement\r\n\thtmlNode.setAttribute('screensize', platform.screensize)\r\n\tif (platform.portrait)\r\n\t\thtmlNode.setAttribute('portrait', '')\r\n\tif (platform.landscape)\r\n\t\thtmlNode.setAttribute('landscape', '')\r\n})\r\nfunction applyQuery(mql, i) {\r\n\t// assigns true or false and given attribute value if mql matches\r\n\tif (mql.matches) {\r\n\t\tif (mql.attrVal)\r\n\t\t\tplatform[mql.attrName] = mql.attrVal\r\n\t\telse\r\n\t\t\tplatform[mql.attrName] = mql.matches\r\n\t\tif (documentReady)\r\n\t\t\thtmlNode.setAttribute(mql.attrName, mql.attrVal)\r\n\t} else if (!mql.attrVal) {\r\n\t\tplatform[mql.attrName] = mql.matches\r\n\t\tif (documentReady)\r\n\t\t\thtmlNode.removeAttribute(mql.attrName)\r\n\t}\r\n}\r\n\r\n\r\nvar debounceMap = new Map\r\n// warning: very naive implementation for single event type.\r\n//          add some memory to store events in (and prevent duplicates) if used broadly\r\nfunction debounceEmit(target, eventName) {\r\n\tvar debounceTimeout = debounceMap.get(eventName)\r\n\tclearTimeout(debounceTimeout)\r\n\tdebounceTimeout = setTimeout(() => {\r\n\t\temit(target, eventName)\r\n\t\t//console.log('emit', eventName)\r\n\t}, 50)\r\n\t//console.log('debounceEmit set', eventName, debounceTimeout)\r\n\tdebounceMap.set(eventName, debounceTimeout)\r\n}\r\n\r\nfunction emitUpdateScreensize() {\r\n\t//console.log('emitUpdateScreensize')\r\n\tdebounceEmit(document, 'screensize-update')\r\n\tdebounceEmit(document, 'formfactor-update')\r\n}\r\nfunction emitUpdateOrientation() {\r\n\t//console.log('emitUpdateOrientation')\r\n\tdebounceEmit(document, 'orientation-update')\r\n\tdebounceEmit(document, 'formfactor-update')\r\n}\r\n\r\nfunction setupLocalBreakpointQueries(element, onAlways, onUpdate, attrName, attrValues) {\r\n\tvar computed = getComputedStyle(element)\r\n\tvar sm = computed.getPropertyValue('--breakpoint-s-m')\r\n\tvar ml = computed.getPropertyValue('--breakpoint-m-l')\r\n\tvar breakpoints = [sm, ml]\r\n\tvar queries = makeBreakpointQueries(breakpoints)\r\n\treturn registerQueries(queries, onAlways, onUpdate, attrName, attrValues)\r\n}\r\n\r\n\r\n// setup core screensize queries\r\nsetupLocalBreakpointQueries(document.documentElement, applyQuery, emitUpdateScreensize, 'screensize', screensizes)\r\n//setupLocalBreakpointQueries(document.body, applyQuery, emitUpdateScreensize, 'screensize', screensizes)\r\n// setup additional orientation queries\r\nregisterQuery('(orientation: portrait)', applyQuery, emitUpdateOrientation, 'portrait')\r\nregisterQuery('(orientation: landscape)', applyQuery, emitUpdateOrientation, 'landscape')\r\n// inform other code relying on formfactor about the update\r\n\r\nganymede.ready.then(() => {\r\n\temit(document, 'formfactor-update')\r\n})\r\n\r\n\r\n\r\nexport let Breakpointable = SuperClass => class extends SuperClass {\r\n\r\n\t@reflect breakpointState = Number\r\n\r\n\tconstructor() {\r\n\t\tsuper()\r\n\t\t//console.log('constructor', this)\r\n\t\tvar applyQuery = (mql, i) => {\r\n\t\t\tif (!mql.matches) return\r\n\t\t\t//console.log('breakpoint', screensizes[i])\r\n\t\t\tthis.breakpointState = screensizes[i]\r\n\t\t}\r\n\t\tvar emitUpdate = (mql, i) => {\r\n\t\t\tif (!mql.matches) return\r\n\t\t\tthis.emit('breakpoint', screensizes[i])\r\n\t\t}\r\n\t\tvar killbacks = setupLocalBreakpointQueries(this, applyQuery, emitUpdate)\r\n\t\tkillbacks.forEach(this.registerKillback)\r\n\t}\r\n\r\n}\r\n\r\nBreakpointable.SMALL  = Breakpointable.S = SMALL\r\nBreakpointable.MEDIUM = Breakpointable.M = MEDIUM\r\nBreakpointable.LARGE  = Breakpointable.L = LARGE\r\n\r\n/*\r\n\t// number of max reached states\r\n\tstatesCount = 1\r\n\t@reflect breakpoint = ''\r\n\r\n\tconstructor() {\r\n\t\tsuper()\r\n\t\tif (this.breakpoint)\r\n\t\t\tthis._setupBreapointQueries()\r\n\t\telse\r\n\t\t\tthis._processBreapointQueries(getCssBreakpoints(this))\r\n\t}\r\n\r\n\t//@observe('breakpoint')\r\n\t_setupBreapointQueries() {\r\n\t\tif (!this.breakpoint) return\r\n\t\tvar breakpoints = String(this.breakpoint).match(/\\d+/g)\r\n\t\tif (!breakpoints) return\r\n\t\tthis._processBreapointQueries(breakpoints)\r\n\t}\r\n\t_processBreapointQueries(breakpoints) {\r\n\t\tconsole.log(breakpoints)\r\n\t\tconsole.log(makeBreakpointQueries(breakpoints))\r\n\t\tvar handleQuery = (mql, i) => {\r\n\t\t\tif (!mql.matches) return\r\n\t\t\tthis.breakpointState = i\r\n\t\t\tthis.emit('breakpoint', i)\r\n\t\t}\r\n\t\tvar queries = makeBreakpointQueries(breakpoints)\r\n\t\tthis.statesCount = queries.length\r\n\t\tqueries\r\n\t\t\t.map(query => window.matchMedia(query))\r\n\t\t\t.forEach((mql, i) => {\r\n\t\t\t\tif (mql.matches)\r\n\t\t\t\t\tthis.breakpointState = i\r\n\t\t\t\tvar listener = mql => handleQuery(mql, i)\r\n\t\t\t\tmql.addListener(listener)\r\n\t\t\t\tthis.registerKillback(() => mql.removeListener(listener))\r\n\t\t\t})\r\n\t}\r\n*/","import {on, once, reflect, observe, autobind, defaultValue} from 'ganymede'\r\nimport {clamp} from './utils.js'\r\nimport {platform} from './platform.js'\r\n\r\n\r\nconst TOP    = -1\r\nconst RIGHT  = 1\r\nconst BOTTOM = 1\r\nconst LEFT   = -1\r\nconst NO_DIR = 0\r\n\r\nexport let Draggable = SuperClass => class extends SuperClass {\r\n\r\n\tstatic TOP    = TOP\r\n\tstatic RIGHT  = RIGHT\r\n\tstatic BOTTOM = BOTTOM\r\n\tstatic LEFT   = LEFT\r\n\tstatic NO_DIR = NO_DIR\r\n\r\n\t@reflect draggable = true\r\n\t//@reflect dragOrientation = 'vertical'\r\n\t@reflect dragOrientation = String\r\n\r\n\t// threshold\r\n\tdragThresholdDisable = false\r\n\tdragThreshold = 0.15\r\n\t// current position percentage\r\n\tdragPercentage = 0\r\n\t// direction from center (from percentage 1) in the drag is available\r\n\tdragDirMod = NO_DIR\r\n\r\n\tsetupDraggableDirection() {\r\n\t\tthis.dragUp\t\t= this.dragUp\t || this.top    || this.hasAttribute('top')\r\n\t\tthis.dragRight\t= this.dragRight || this.right  || this.hasAttribute('right')\r\n\t\tthis.dragDown\t= this.dragDown\t || this.bottom || this.hasAttribute('bottom')\r\n\t\tthis.dragLeft\t= this.dragLeft\t || this.left   || this.hasAttribute('left')\r\n\t\tif (this.dragUp)\tthis.dragDirMod = TOP\r\n\t\tif (this.dragRight)\tthis.dragDirMod = RIGHT\r\n\t\tif (this.dragDown)\tthis.dragDirMod = BOTTOM\r\n\t\tif (this.dragLeft)\tthis.dragDirMod = LEFT\r\n\t\tif (!this.dragOrientation) {\r\n\t\t\tif (this.dragRight || this.dragLeft)\r\n\t\t\t\tthis.dragOrientation = 'horizontal'\r\n\t\t\telse if (this.dragUp || this.dragDown)\r\n\t\t\t\tthis.dragOrientation = 'vertical'\r\n\t\t}\r\n\t}\r\n\r\n\t//@once('beforeready')\r\n\t@once('ready')\r\n\tsetupDraggable() {\r\n\t\t//console.log('setupDraggable', this.dragPercentage, this.hidden, this)\r\n\t\tthis.setupDraggableDirection()\r\n\t\tif (!this.dragOrientation) return\r\n\t\tthis.setupDraggableHandlers()\r\n\t\tif (!this.dragThresholdDisable)\r\n\t\t\tthis.setupDraggableThreshold()\r\n\t\t//this.setupWheel()\r\n\t\tthis.dragRender()\r\n\t}\r\n\r\n\tsetupDraggableThreshold() {\r\n\t\tthis.on('drag-start', e => {\r\n\t\t\tif (this.dragPercentage === 0)\r\n\t\t\t\tthis.dragThresholdTarget = this.dragThreshold\r\n\t\t\telse\r\n\t\t\t\tthis.dragThresholdTarget = this.dragPercentage - this.dragThreshold\r\n\t\t})\r\n\t\tthis.on('drag-end', e => {\r\n\t\t\tif (!this.dragMoved) return\r\n\t\t\tif (this.dragPercentage > this.dragThresholdTarget)\r\n\t\t\t\tthis.emit('show')\r\n\t\t\telse\r\n\t\t\t\tthis.emit('hide')\r\n\t\t})\r\n\t}\r\n\r\n\r\n\t///////////////////////////////////////////////////////////////////////////\r\n\t///////////////////////////// EVENT LISTENERS /////////////////////////////\r\n\t///////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\tsetupDraggableHandlers() {\r\n\t\tthis.addEventListener('pointerdown', this.onDragStart)\r\n\t\tthis.registerKillback(() => this.removeEventListener('pointerdown', this.onDragStart))\r\n\t}\r\n\r\n\t@autobind onDragStart(e) {\r\n\t\t// only continue if can drag\r\n\t\tif (!this.draggable) return\r\n\t\t//if (!this.dragOrientation) return\r\n\t\t// default event handling and attaching following listeners\r\n\t\te.stopPropagation()\r\n\t\t//if (e.pointerType == 'mouse')\r\n\t\t//\te.preventDefault()\r\n\t\tthis.dragSkipFirstMoveBeforeCancel = true\r\n\t\tdocument.addEventListener('pointercancel', this.onDragEnd)\r\n\t\tdocument.addEventListener('pointermove', this.onDragMove)\r\n\t\tdocument.addEventListener('pointerup', this.onDragEnd)\r\n\t\tthis.dragStartHandler(e)\r\n\t}\r\n\t@autobind onDragMove(e) {\r\n\t\t// default event handling\r\n\t\te.stopPropagation()\r\n\t\tif (this.dragSkipFirstMoveBeforeCancel)\r\n\t\t\treturn this.dragSkipFirstMoveBeforeCancel = false\r\n\t\tthis.dragMoveHandler(e)\r\n\t}\r\n\t@autobind onDragEnd(e) {\r\n\t\t// default event handling\r\n\t\te.stopPropagation()\r\n\t\t//e.preventDefault()\r\n\t\tdocument.removeEventListener('pointercancel', this.onDragEnd)\r\n\t\tdocument.removeEventListener('pointermove', this.onDragMove)\r\n\t\tdocument.removeEventListener('pointerup', this.onDragEnd)\r\n\t\tthis.dragEndHandler(e)\r\n\t}\r\n\r\n\r\n\t///////////////////////////////////////////////////////////////////////////\r\n\t///////////////////////// MUNIPULATION & RENDERING ////////////////////////\r\n\t///////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\tgetDragDistance() {\r\n\t\tif (this.dragOrientation === 'horizontal')\r\n\t\t\treturn this.offsetWidth\r\n\t\telse if (this.dragOrientation === 'vertical')\r\n\t\t\treturn this.offsetHeight\r\n\t}\r\n\tgetDragPosition(e) {\r\n\t\tif (this.dragOrientation === 'horizontal')\r\n\t\t\treturn e.x\r\n\t\telse if (this.dragOrientation === 'vertical')\r\n\t\t\treturn e.y\r\n\t}\r\n\r\n\tdragStartHandler(e) {\r\n\t\t// individual code\r\n\t\tthis.totalDistance = this.getDragDistance()\r\n\t\t// horizontal code\r\n\t\tthis.initDragPosition = this.getDragPosition(e)\r\n\t\t// shared code\r\n\t\tthis.dragMoved = false\r\n\t\tthis.dragInitPercentage = this.dragPercentage\r\n\t\t// show [dragging] attribute for elements to suppres transitions, etc...\r\n\t\tthis.setAttribute('dragging', '')\r\n\t\tthis.emit('drag-start')\r\n\t}\r\n\tdragMoveHandler(e) {\r\n\t\t//e.preventDefault()\r\n\t\t// only continue if can drag\r\n\t\t//if (!this.dragOrientation) return\r\n\t\tvar dragged = this.getDragPosition(e) - this.initDragPosition\r\n\t\t// move events gets fired even though move didnt happen\r\n\t\tif (dragged !== 0)\r\n\t\t\tthis.dragMoved = true\r\n\t\t//var percentage = this.dragInitPercentage - (dragged / this.totalDistance)\r\n\t\tvar percentage = this.dragInitPercentage - ((dragged / this.totalDistance) * this.dragDirMod)\r\n\t\tthis.dragPercentage = clamp(percentage, 0, 1)\r\n\t\t//this.dragPercentage = clamp(percentage, this.dragClampMin, this.dragClampMax)\r\n\t\tthis.dragRender(this.dragPercentage)\r\n\t\tthis.emit('drag', this.dragPercentage)\r\n\t}\r\n\tdragEndHandler(e) {\r\n\t\t// only continue if can drag\r\n\t\t//if (!this.dragOrientation) return\r\n\t\t// remove [dragging] attribute for elements to reenable transitions, etc...\r\n\t\tthis.removeAttribute('dragging')\r\n\t\tthis.emit('drag-end')\r\n\t}\r\n\r\n\t//@on('drag')\r\n\tdragRender(percentage = this.dragPercentage) {\r\n\t\tvar value = (1 - percentage) * this.dragDirMod * 100\r\n\t\t//console.log('dragRender', value, percentage, this.dragPercentage, this.hidden, this.visible, this)\r\n\t\tthis._dragRender(value)\r\n\t}\r\n\t_dragRender(value) {\r\n\t\tif (this.dragOrientation === 'horizontal')\r\n\t\t\tthis._dragRenderHorizontal(value)\r\n\t\telse\r\n\t\t\tthis._dragRenderVertical(value)\r\n\t}\r\n\t_dragRenderHorizontal(value) {\r\n\t\tthis.style.transform = `translate3d(${value}%, 0px, 0)`\r\n\t}\r\n\t_dragRenderVertical(value) {\r\n\t\tthis.style.transform = `translate3d(0px, ${value}%, 0)`\r\n\t}\r\n\r\n\r\n\t///////////////////////////////////////////////////////////////////////////\r\n\t////////////////////////// MOUSEWHEEL EXPERIMENT //////////////////////////\r\n\t///////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n/*\r\n\t@observe('draggable')\r\n\tsetupWheel() {\r\n\t\tif (this.draggable && this.dragByWheel && !this.dragWheelListening) {\r\n\t\t\tthis.attachWheel()\r\n\t\t} else {\r\n\t\t\tthis.detachWheel()\r\n\t\t}\r\n\t}\r\n\r\n\t// stand in for PAN-UP/PAN-DOWN to close fom touch devices to wheel\r\n\t@reflect dragByWheel = true\r\n\tdragWheelListening = false\r\n\tattachWheel() {\r\n\t\tconsole.log('&&& attachWheel')\r\n\t\tif (this.dragWheelListening) return\r\n\t\tvar name = 'mousewheel'// 'DOMMouseScroll'\r\n\t\tthis.addEventListener('mousewheel', this.onWheel)\r\n\t\tconsole.log('attached')\r\n\t}\r\n\tdetachWheel() {\r\n\t\tif (!this.dragWheelListening) return\r\n\t\tvar name = 'mousewheel'// 'DOMMouseScroll'\r\n\t\tthis.removeEventListener('mousewheel', this.onWheel, {passive: true})\r\n\t}\r\n\t_wheelTimeout\r\n\twheelPristine = true\r\n\twheelTimeout = 100\r\n\twheelDragged = 0\r\n\t@autobind onWheel(e) {\r\n\t\t//var scrolled = e.wheelDeltaY\r\n\t\tthis.wheelDragged += e.wheelDeltaY\r\n\t\tvar scrolled = this.wheelDragged\r\n\t\tconsole.log('', scrolled, '|', this.canDragDown, this.isScrolledToTop, scrolled >= 0, '|', this.canDragUp, this.isScrolledToBottom, scrolled <= 0)\r\n\t\tif ((this.canDragDown && this.isScrolledToTop    && scrolled >= 0)\r\n\t\t||  (this.canDragUp   && this.isScrolledToBottom && scrolled <= 0)) {\r\n\t\t\te.preventDefault()\r\n\t\t\te.stopPropagation()\r\n\t\t} else {\r\n\t\t\treturn\r\n\t\t}\r\n\t\t// mousewheel events dont have start/move/end, so we have to figure out\r\n\t\t// ourself through timeouts\r\n\t\tclearTimeout(this._wheelTimeout)\r\n\t\tthis._wheelTimeout = setTimeout(this.onWheelTimeout, this.wheelTimeout)\r\n\t\tif (this.wheelPristine) {\r\n\t\t\tthis.wheelPristine = false\r\n\t\t\tthis.wheelStartHandler(e)\r\n\t\t} else {\r\n\t\t\tthis.wheelMoveHandler(e)\r\n\t\t}\r\n\t}\r\n\t@autobind onWheelTimeout() {\r\n\t\tthis.wheelPristine = true\r\n\t\tthis.wheelEndHandler()\r\n\t}\r\n\r\n\twheelStartHandler(e) {\r\n\t\t// individual code\r\n\t\tthis.totalDistance = this.getDragDistance()\r\n\t\t// horizontal code\r\n\t\t//this.initDragPosition = this.getDragPosition(e)\r\n\t\t// shared code\r\n\t\tthis.dragMoved = false\r\n\t\tthis.dragInitPercentage = this.dragPercentage\r\n\t\t// show [dragging] attribute for elements to suppres transitions, etc...\r\n\t\tthis.setAttribute('dragging', '')\r\n\t\tthis.emit('drag-start')\r\n\t}\r\n\twheelMoveHandler(e) {\r\n\t\t//e.preventDefault()\r\n\t\t// only continue if can drag\r\n\t\t//if (!this.dragOrientation) return\r\n\t\tvar dragged = this.wheelDragged\r\n\t\tconsole.log('dragged', dragged)\r\n\t\t//var dragged = this.getDragPosition(e) - this.initDragPosition\r\n\t\t// move events gets fired even though move didnt happen\r\n\t\tif (dragged !== 0)\r\n\t\t\tthis.dragMoved = true\r\n\t\t//var percentage = this.dragInitPercentage - (dragged / this.totalDistance)\r\n\t\tvar percentage = this.dragInitPercentage - ((dragged / this.totalDistance) * this.dragDirMod)\r\n\t\tthis.dragPercentage = clamp(percentage, 0, 1)\r\n\t\t//this.dragPercentage = clamp(percentage, this.dragClampMin, this.dragClampMax)\r\n\t\tthis.dragRender(this.dragPercentage)\r\n\t\tthis.emit('drag', this.dragPercentage)\r\n\t}\r\n\twheelEndHandler() {\r\n\t\t// only continue if can drag\r\n\t\t//if (!this.dragOrientation) return\r\n\t\t// remove [dragging] attribute for elements to reenable transitions, etc...\r\n\t\tthis.removeAttribute('dragging')\r\n\t\tthis.emit('drag-end')\r\n\t\tthis.wheelDragged = 0\r\n\t}\r\n*/\r\n\r\n\r\n\r\n\r\n\t// todo, add event listener to pressing escape key to close view\r\n\t//@reflect closeByEscape = false\r\n\tsetupEscClose() {\r\n\t\tif (!this.dismissable) return\r\n\t\t// TODO\r\n\t}\r\n\r\n\r\n}\r\n\r\n// probably temporary function, to be deleted\r\nfunction isDescendant(parent, child) {\r\n\tvar node = child.parentNode\r\n\twhile (node !== null) {\r\n\t\tif (node === parent)\r\n\t\t\treturn true\r\n\t\tnode = node.parentNode\r\n\t}\r\n\treturn false\r\n}\r\n\r\n\r\n","import {on, once, reflect, observe, autobind, defaultValue} from 'ganymede'\r\nimport {clamp} from './utils.js'\r\nimport {platform} from './platform.js'\r\nimport {SCREENSIZE} from './breakpoints.js'\r\n\r\n\r\n\r\nvar overlayMaxOpacity = 0.7\r\n\r\n// Panel requires to be used together with Visibility class\r\nexport let Panel = SuperClass => class extends SuperClass {\r\n\t\r\n\t@defaultValue(true)\r\n\t@reflect dragEdge\r\n\r\n\t@defaultValue(platform.material)\r\n\t@reflect overlayFade\r\n\r\n//\t@reflect overlayFade = true\r\n\r\n\t// todo rename to hasOverlay\r\n\t@defaultValue(true)\r\n\t@reflect overlayBg\r\n\r\n\t// docked\r\n\t@reflect pinnable = false\r\n\t@reflect pinned = false\r\n\t//@reflect pinned = Boolean\r\n\t// automaticaly show on larger screen, if the panel if its pinnable\r\n\t// false = panel does not show up automatically on larger screens, even if its pinnable\r\n\t// true  = panel becomes visible on larger screens if pinnable\r\n\t@reflect autoShow = Boolean\r\n\t// automaticaly hide after resizing down,\r\n\t// false = pinned panel becomes overlay on smaller screen and does not hide\r\n\t// true  = pinned panel becomes hidden on smaller screen\r\n\t@reflect autoHide = Boolean\r\n\r\n\t//@reflect dismissable = false\r\n\t@reflect panel = true\r\n\thasOverlayBg = false\r\n\t@reflect overlayBg = Boolean\r\n\r\n\t@reflect top = Boolean\r\n\t@reflect right = Boolean\r\n\t@reflect bottom = Boolean\r\n\t@reflect left = Boolean\r\n\r\n\tzIndex = 200\r\n\r\n\t// [visible] = panel is in shown in overlay mode\r\n\t// [visible][pinned] = panel is in shown in pinned mode\r\n\r\n\tconstructor() {\r\n\t\tsuper()\r\n\t\t// set soft default value\r\n\t\tif (this.overlayBg === undefined)\r\n\t\t\tthis.overlayBg = true\r\n\t\t// store the default value for future state changes\r\n\t\t// note: this is only used by inheritors, since by the time constructor is called\r\n\t\t//       no attribute values were read and assigned yet\r\n\t\tthis.__overlayBgDefault = this.overlayBg\r\n\t}\r\n\r\n\t//@once('ready')\r\n\t@once('beforeready')\r\n\tsetupPanel() {\r\n\t\t//console.log('setupPanel --------------------------------------')\r\n\t\t//console.log(this)\r\n\t\t//console.log('this.hidden', this.hidden)\r\n\t\t//console.log('this.visible', this.visible)\r\n\t\t//console.log('this.pinned', this.pinned)\r\n\t\t//console.log('this.pinnable', this.pinnable)\r\n\t\t//console.log('---')\r\n\t\tif (!this.panel) return\r\n\r\n\t\tthis.autoAssignPosition()\r\n\r\n\t\tvar isForciblyVisible = this.visible === true\r\n\t\tvar isForciblyHidden  = this.hidden === true\r\n\r\n\t\tif (this.autoShow === undefined)\r\n\t\t\tif (this.hidden)\r\n\t\t\t\tthis.autoShow = false\r\n\t\t\telse\r\n\t\t\t\tthis.autoShow = true\r\n\t\tif (this.autoHide === undefined)\r\n\t\t\tif (this.hidden)\r\n\t\t\t\tthis.autoHide = true\r\n\t\t\telse\r\n\t\t\t\tthis.autoHide = false\r\n\r\n\t\tif (this.hidden === undefined && this.visible === undefined)\r\n\t\t\tthis.hidden = true\r\n\t\telse if (this.visible === true)\r\n\t\t\tthis.hidden = false\r\n\t\telse if (this.hidden === true)\r\n\t\t\tthis.visible = false\r\n\t\telse if (this.visible === false)\r\n\t\t\tthis.hidden = true\r\n\t\telse if (this.hidden === false)\r\n\t\t\tthis.visible = true\r\n\t\t// ensure visible/hidden are correctly loaded\r\n\t\t//this.configureVisibilityAttributes()\r\n\t\t// if [pinned] was manually enabled, store info about it as pinnable\r\n\t\tif (this.pinned)\r\n\t\t\tthis.pinnable = true\r\n\t\t// if this panel can become pinned, only pin it if the screensize is right\r\n\t\tif (this.pinnable && this.autoShow && (isForciblyVisible || !isForciblyHidden))\r\n\t\t//if (this.pinnable && this.autoShow && this.hidden !== true)\r\n\t\t\tthis.pinned = platform.screensize === 'l'\r\n\t\telse if (this.pinned === undefined)\r\n\t\t\tthis.pinned = false\r\n\t\t// and if not, hide it (not to show big overlay)\r\n\t\tif (this.pinned)\r\n\t\t\tthis.hidden = false\r\n\t\t//console.log('this.hidden', this.hidden)\r\n\t\t//console.log('this.visible', this.visible)\r\n\t\t//console.log('this.pinned', this.pinned)\r\n\t\t//console.log('this.pinnable', this.pinnable)\r\n\t\t//console.log('side', this.top, this.right, this.bottom, this.left)\r\n\t\t//if (this.hasOverlayBg)\r\n\t\tthis.setupDragOverlay()\r\n\t\t//console.log('this.dragEdge', this.dragEdge, 'this.dragOrientation', this.dragOrientation)\r\n\t\t//if (this.dragEdge && this.dragOrientation)\r\n\t\tif (this.dragEdge)\r\n\t\t\tthis.setupDragEdge()\r\n\t\t// NOTE: not using @on, nor @autobind because of inheritance\r\n\t\t// and possible changes by inheritors classes\r\n\t\t//this.on('show', () => this.onShow())\r\n\t\t//this.on('hide', () => this.onHide())\r\n\t\tthis.applyDragVisibleState()\r\n\t\tif (this.id)\r\n\t\t\tthis.attachInvokerListeners()\r\n\t\t// re render pinned\r\n\t\t//console.log('CALLING pinnedChanged')\r\n\t\tthis.pinnedChanged()\r\n\t\t//console.log('CALLING applyVisibilityState')\r\n\t\tthis.applyVisibilityState()\r\n\t}\r\n\r\n\tautoAssignPosition() {\r\n\t\tif (this.top || this.right || this.bottom || this.left) return\r\n\t\tif (this.hasAttribute('right') || this.hasAttribute('left')) return\r\n\t\tvar next = this.nextElementSibling\r\n\t\tvar prev = this.previousElementSibling\r\n\t\tif (next === null || next.localName !== 'flexus-view') {\r\n\t\t\tthis.right = true\r\n\t\t\t//this.setAttribute('right', '')\r\n\t\t} else if (prev === null || prev.localName !== 'flexus-view') {\r\n\t\t\tthis.left = true\r\n\t\t\tthis.setAttribute('left', '')\r\n\t\t}\r\n\t}\r\n\r\n\tattachInvokerListeners() {\r\n\t\t// lets wait for a good measure\r\n\t\tsetTimeout(() => this._attachInvokerListeners())\r\n\t}\r\n\t_attachInvokerListeners() {\r\n\t\tvar nodes = Array.from(document.querySelectorAll(`[for=\"${this.id}\"]`))\r\n\t\tnodes.forEach(node => {\r\n\t\t\t//console.log('node', node)\r\n\t\t\t// note: autobound #show(), #hide(), #toggle() are all inherited from Visibility class\r\n\t\t\tthis.on(node, 'click', this.toggle)\r\n\t\t})\r\n\t}\r\n\r\n\r\n\t@on(document, 'screensize-update', self => self.panel)\r\n\tonResize() {\r\n\t\tif (platform.screensize === SCREENSIZE.LARGE) {\r\n\t\t\t//console.log('onResize LARGE')\r\n\t\t\t//console.log('this.pinned', this.pinned, '->', this.pinnable)\r\n\t\t\tthis.pinned = this.pinnable\r\n\t\t} else {\r\n\t\t\t//console.log('onResize OTHER')\r\n\t\t\t//console.log('this.pinned', this.pinned, '->', false)\r\n\t\t\tthis.pinned = false\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t@on('show')\r\n\tonShowPanel(percentage) {\r\n\t\t//console.log('### onShowPanel')\r\n\t\t//if (!this.hidden) return\r\n\t\tthis.dragPercentage = 1\r\n\t\tif (this.draggable)\r\n\t\t\tthis.dragRender()\r\n\t\t// make overlay clickable\r\n\t\tif (this.overlayBg && this.overlayElement)\r\n\t\t\tthis.overlayElement.show()\r\n\t\t// assign universal api [hidden] attribute\r\n\t\t// (css to be handled by inheritor)\r\n\t\t//this.removeAttribute('hidden')\r\n\t\tthis.hidden = false\r\n\t\tthis.applyDragVisibleState()\r\n\t}\r\n\r\n\t@on('hide')\r\n\tonHidePanel(percentage) {\r\n\t\t//console.log('### onHidePanel')\r\n\t\t//if (this.pinned) return\r\n\t\t//if (this.hidden) return\r\n\t\tthis.dragPercentage = 0\r\n\t\tif (this.draggable)\r\n\t\t\tthis.dragRender()\r\n\t\t// make overlay click through again\r\n\t\tif (this.overlayBg && this.overlayElement)\r\n\t\t\tthis.overlayElement.hide()\r\n\t\t// assign universal api [hidden] attribute\r\n\t\t// (css to be handled by inheritor)\r\n\t\t//this.setAttribute('hidden', '')\r\n\t\tthis.hidden = true\r\n\t\tthis.applyDragHiddenState()\r\n\t}\r\n\r\n\tpin() {\r\n\t\tthis.pinned = true\r\n\t}\r\n\tunpin() {\r\n\t\tthis.pinned = false\r\n\t}\r\n\r\n\t// dock\r\n\tonPinPanel() {\r\n\t\t//console.log('### onPinPanel')\r\n\t\t//if (this.pinned) return\r\n\t\tthis.overlayBg = false\r\n\t\tif (this.overlayElement)\r\n\t\t\tthis.overlayElement.hide()\r\n\t\tif (this.autoShow) {\r\n\t\t\t//this.dragPercentage = 1\r\n\t\t\t//this.dragRender()\r\n\t\t\t//this.hidden = false\r\n\t\t\tthis.show()\r\n\t\t\tthis.dragRender()\r\n\t\t}\r\n\t\tthis.draggable = false\r\n\t\t//this.dismissable = true\r\n\t}\r\n\r\n\t// undock\r\n\tonUnpinPanel() {\r\n\t\t//console.log('### onUnpinPanel')\r\n\t\t//if (!this.pinned) return\r\n\t\tthis.overlayBg = this.__overlayBgDefault\r\n\t\tthis.draggable = true\r\n\t\tif (this.overlayElement && this.overlayBg)\r\n\t\t\tthis.overlayElement.show()\r\n\t\tif (this.autoHide) {\r\n\t\t\t//this.dragPercentage = 0\r\n\t\t\t//this.dragRender()\r\n\t\t\tthis.hide()\r\n\t\t}\r\n\t\t//this.dismissable = false\r\n\t}\r\n\r\n\t// TODO: bug in ganymede does not automatically assign 'pinnedChanged' as observer.\r\n\t// Something must be wrong with the 'Changed' observer detection\r\n\t@observe('pinned')\r\n\tpinnedChanged() {\r\n\t\tif (this.pinned)\r\n\t\t\tthis.onPinPanel()\r\n\t\telse\r\n\t\t\tthis.onUnpinPanel()\r\n\t}\r\n\r\n\thiddenChanged(hidden) {\r\n\t\tif (hidden === false && this.dragPercentage !== 1)\r\n\t\t\tthis.show()\r\n\t\telse if (hidden === true && this.dragPercentage !== 0)\r\n\t\t\tthis.hide()\r\n\t}\r\n\r\n\tapplyVisibilityState() {\r\n\t\tif (this.hidden === true)\r\n\t\t\tthis.hide()\r\n\t\telse if (this.hidden === false)\r\n\t\t\tthis.show()\r\n\t}\r\n\tforceVisibilityState() {\r\n\t\tif (this.hidden === true) {\r\n\t\t\tthis.hide()\r\n\t\t\tthis.onHidePanel()\r\n\t\t} else if (this.hidden === false) {\r\n\t\t\tthis.show()\r\n\t\t\tthis.onShowPanel()\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t// dragLeft is fixed, meaning the panel is on left side,\r\n\t// meaning it can be dragged (from active state) to left to close it\r\n\t// canDragLeft is state based and is true if the panel is openned\r\n\t// and then becomes false whereas canDragRight becomes true when closed\r\n\tapplyDragVisibleState() {\r\n\t\tthis.canDragUp = this.dragUp\r\n\t\tthis.canDragRight = this.dragRight\r\n\t\tthis.canDragDown = this.dragDown\r\n\t\tthis.canDragLeft = this.dragLeft\r\n\t}\r\n\tapplyDragHiddenState() {\r\n\t\t// pannel is hidden, set drag direction in which it can be dragged out\r\n\t\t// from over the edge\r\n\t\tthis.canDragUp = false\r\n\t\tthis.canDragRight = false\r\n\t\tthis.canDragDown = false\r\n\t\tthis.canDragLeft = false\r\n\t\tif (this.dragDown)\tthis.canDragUp = true\r\n\t\tif (this.dragLeft)\tthis.canDragRight = true\r\n\t\tif (this.dragUp)\tthis.canDragDown = true\r\n\t\tif (this.dragRight)\tthis.canDragLeft = true\r\n\t}\r\n\r\n\tsetupDragOverlay() {\r\n\t\t//console.log('setupDragOverlay')\r\n\t\tthis.overlayElement = createOverlay(this, this.overlayFade)\r\n\t\t//this.on(this.overlayElement, 'click', () => this.hide())\r\n\t\tthis.on(this.overlayElement, 'click', () => this.onOverlayClick())\r\n\t\tthis.on('drag-start', () => {\r\n\t\t\tif (!this.overlayBg) return\r\n\t\t\tthis.overlayElement.dragstart()\r\n\t\t\tif (!this.overlayFade) return\r\n\t\t\tthis.on('drag', this.overlayElement.drag)\r\n\t\t})\r\n\t\tthis.on('drag-end', () => {\r\n\t\t\tif (!this.overlayBg) return\r\n\t\t\tthis.overlayElement.dragend()\r\n\t\t\tif (!this.overlayFade) return\r\n\t\t\tthis.off('drag', this.overlayElement.drag)\r\n\t\t})\r\n\t}\r\n\r\n\t// this is a separate function to be overriden by inheritors\r\n\tonOverlayClick() {\r\n\t\tthis.hide()\r\n\t}\r\n\r\n\tsetupDragEdge() {\r\n\t\tthis.edgeElement = document.createElement('div')\r\n\t\tthis.edgeElement.setAttribute('edge', '')\r\n\t\tthis.appendChild(this.edgeElement)\r\n\t\t//console.log('setupDragEdge', this.edgeElement)\r\n\t}\r\n\r\n}\r\n\r\nfunction createOverlay(overlayForElement, overlayFade) {\r\n\tvar overlay = document.createElement('div')\r\n\tif (platform.neon)\r\n\t\toverlay.style.opacity = '0 !important'\r\n\t//console.warn('remove me')\r\n\toverlay.className = 'fx-overlay'\r\n\toverlay.setAttribute('hidden', '')\r\n\tif (overlayFade)\r\n\t\toverlay.setAttribute('fade', '')\r\n\tif (overlayForElement) {\r\n\t\t/*var zIndex = overlayForElement.zIndex\r\n\t\t\t\t|| overlayForElement.style.zIndex\r\n\t\t\t\t|| parseInt(getComputedStyle(overlayForElement).zIndex)\r\n\t\t\t\t|| 500*/\r\n\t\tvar zIndex =  parseInt(getComputedStyle(overlayForElement).zIndex)\r\n\t\toverlay.style.zIndex = zIndex\r\n\t\toverlayForElement.before(overlay)\r\n\t}\r\n\toverlay.show = function(val) {\r\n\t\toverlay.style.opacity = ''\r\n\t\toverlay.removeAttribute('hidden')\r\n\t}\r\n\toverlay.hide = function(val) {\r\n\t\toverlay.style.opacity = ''\r\n\t\toverlay.setAttribute('hidden', '')\r\n\t}\r\n\toverlay.drag = percentage => {\r\n\t\t//console.log('drag', percentage)\r\n\t\toverlay.style.opacity = percentage * overlayMaxOpacity\r\n\t}\r\n\toverlay.dragstart = () => {\r\n\t\t//overlay.style.zIndex = this.zIndex - 1\r\n\t\toverlay.style.transition = 'none'\r\n\t}\r\n\toverlay.dragend = () => {\r\n\t\toverlay.style.transition = ''\r\n\t}\r\n\treturn overlay\r\n}\r\n","import {on, once, reflect, autobind, defaultValue, observe} from 'ganymede'\r\nimport {clamp} from './utils.js'\r\nimport {rafThrottle} from './raf.js'\r\n\r\n\r\n\r\n//class Listeners extends Array {\r\n//}\r\n\r\nexport let Scrollable = SuperClass => class extends SuperClass {\r\n\r\n\tscrollTarget = undefined\r\n\tscrollListeners = []\r\n\r\n\tisScrolledToTop = true\r\n\tisScrolledToBottom = true\r\n\r\n\t// keeps reflecting touch-action css property according to scroll position\r\n\tscrollReflectsTouchAction = false\r\n\r\n\t//@once('ready')\r\n\tsetupScrollable(target) {\r\n\t\ttarget = this.scrollTarget || target\r\n\t\t// for now only available for scrolling on <main> elements\r\n\t\tif (!target || target.localName !== 'main') {\r\n\t\t\tthis.scrollTarget = target = undefined\r\n\t\t\treturn false\r\n\t\t}\r\n\t\tthis.scrollTarget = target\r\n\t\t// merge local and preexisting scroll listeners in case scrollTarget is shared\r\n\t\t// between multiple consumers\r\n\t\t// WARNING: it is necessary to share single scrollListeners array by reference\r\n\t\t//          with everyone listening to the same scrollTarget\r\n\t\tvar listeners = target.scrollListeners = target.scrollListeners || []\r\n\t\tlisteners.push(...this.scrollListeners)\r\n\t\tthis.scrollListeners = listeners\r\n\t\t// some scrollable elements need to update their touch-action in combination with Draggable\r\n\t\tif (this.scrollReflectsTouchAction) {\r\n\t\t\tlisteners.push(this.onScrollChange)\r\n\t\t\tthis.updateTouchAction()\r\n\t\t}\r\n\t\tthis.executeScrollThrottled = rafThrottle(() => {\r\n\t\t\tvar scrolled = this.scrolled\r\n\t\t\tfor (var i = 0; i < listeners.length; i++)\r\n\t\t\t\tlisteners[i](scrolled)\r\n\t\t})\r\n\t\tthis.startScrollListening()\r\n\t\treturn true\r\n\t}\r\n\r\n\tstartScrollListening() {\r\n\t\tvar target = this.scrollTarget\r\n\t\tif (this.scrollListeners.length === 0) return false\r\n\t\tif (target.scrollListenerActive) return false\r\n\t\ttarget.addEventListener('scroll', this.executeScrollThrottled, {passive: true})\r\n\t\ttarget.scrollListenerActive = true\r\n\t\treturn true\r\n\t}\r\n\tendScrollListening() {\r\n\t\tvar target = this.scrollTarget\r\n\t\tif (this.scrollListeners.length > 0) return false\r\n\t\tif (!target.scrollListenerActive) return false\r\n\t\ttarget.removeEventListener('scroll', this.executeScrollThrottled)\r\n\t\ttarget.scrollListenerActive = false\r\n\t\treturn true\r\n\t}\r\n\r\n\taddScrollListeners(listener) {\r\n\t\tthis.scrollListeners.push(listener)\r\n\t\tthis.startScrollListening()\r\n\t}\r\n\tremoveScrollListeners(listener) {\r\n\t\tvar index = this.scrollListeners.indexOf(listener)\r\n\t\tif (index !== -1)\r\n\t\t\tthis.scrollListeners.splice(index, 1)\r\n\t\tthis.endScrollListening()\r\n\t}\r\n\r\n\tupdateTouchAction() {\r\n\t\tif (this.isContentScrollable) {\r\n\t\t\tthis.onScrollChange(this.scrolled)\r\n\t\t\tthis.reflectTouchAction()\r\n\t\t} else {\r\n\t\t\tthis.isScrolledToTop = true\r\n\t\t\tthis.isScrolledToBottom = true\r\n\t\t}\r\n\t}\r\n\r\n\t@autobind onScrollChange(scrolled) {\r\n\t\tvar max = this.maxScrollable\r\n\t\tif (scrolled <= 0) {\r\n\t\t\t//console.log('onScrollChange start', scrolled)\r\n\t\t\tthis.isScrolledToTop = true\r\n\t\t\tthis.isScrolledToBottom = false\r\n\t\t} else if (scrolled >= max) {\r\n\t\t\t//console.log('onScrollChange end', scrolled)\r\n\t\t\tthis.isScrolledToTop = false\r\n\t\t\tthis.isScrolledToBottom = true\r\n\t\t} else {\r\n\t\t\t//console.log('onScrollChange mid', scrolled)\r\n\t\t\tthis.isScrolledToTop = false\r\n\t\t\tthis.isScrolledToBottom = false\r\n\t\t}\r\n\t}\r\n\r\n\t@observe('isScrolledToTop', 'isScrolledToBottom')\r\n\treflectTouchAction() {\r\n\t\t//console.log('reflectTouchAction')\r\n\t\t//if (!this.scrollTarget)\r\n\t\t//\treturn\r\n\t\tif (this.isScrolledToTop && this.isScrolledToBottom)\r\n\t\t\tthis.scrollTarget.style.touchAction = 'none'\r\n\t\telse if (this.isScrolledToTop)\r\n\t\t\tthis.scrollTarget.style.touchAction = 'pan-down'\r\n\t\telse if (this.isScrolledToBottom)\r\n\t\t\tthis.scrollTarget.style.touchAction = 'pan-up'\r\n\t\telse\r\n\t\t\tthis.scrollTarget.style.touchAction = 'pan-y'\r\n\t\t//console.log('touch-action', this.scrollTarget.style.touchAction, this)\r\n\t\t//console.log('touch-action', this.scrollTarget.style.touchAction)\r\n\t}\r\n\r\n\tget scrolled() {\r\n\t\treturn Math.round(this.scrollTarget.scrollTop)\r\n\t}\r\n\t// return true if content of scrolltarget is taller than whats visible\r\n\tget isContentScrollable() {\r\n\t\tvar scrollTarget = this.scrollTarget\r\n\t\treturn scrollTarget.scrollHeight !== scrollTarget.offsetHeight\r\n\t}\r\n\tget maxScrollable() {\r\n\t\tvar scrollTarget = this.scrollTarget\r\n\t\treturn scrollTarget.scrollHeight - scrollTarget.offsetHeight\r\n\t}\r\n\r\n}\r\n\r\n\r\nconst UP     = -1\r\nconst RIGHT  = 1\r\nconst DOWN   = 1\r\nconst LEFT   = -1\r\nconst NO_DIR = 0\r\n\r\n// class implementing Retractable is required to also inherit Scrollable\r\n// it also asumes 'scrollTarget' is defined on ready event\r\nexport let Retractable = SuperClass => class extends SuperClass {\r\n\r\n\tstatic UP     = UP\r\n\tstatic RIGHT  = RIGHT\r\n\tstatic DOWN   = DOWN\r\n\tstatic LEFT   = LEFT\r\n\tstatic NO_DIR = NO_DIR\r\n\r\n\t@reflect retractable = true\r\n\t// direction from center\r\n\tretractDirMod = UP\r\n/*\r\n\t@on('ready')\r\n\tonRetractableReady() {\r\n\t\tconsole.log('onRetractableReady', this.retractable)\r\n\t\tif (!this.retractable) return\r\n\t\tvar thisStyle = this.style\r\n\t\tvar pivot = 0\r\n\t\tvar totalScrolled = 0\r\n\t\tvar lastY = 0\r\n\t\tvar timeout\r\n\t\tvar inactivated = () => {\r\n\t\t\tif (Math.abs(lastY) < this.offsetHeight / 2) {\r\n\t\t\t\tpivot = totalScrolled\r\n\t\t\t\tthis.show()\r\n\t\t\t} else {\r\n\t\t\t\tpivot = totalScrolled - this.offsetHeight\r\n\t\t\t\tthis.hide()\r\n\t\t\t}\r\n\t\t\tconsole.log('inactivated |',\r\n\t\t\t\t'lastY', lastY,\r\n\t\t\t\t'totalScrolled', totalScrolled,\r\n\t\t\t\t'this.offsetHeight', this.offsetHeight,\r\n\t\t\t\t'|', lastY < this.offsetHeight / 2)\r\n\t\t}\r\n\t\tvar onScroll = scrolled => {\r\n\t\t\tclearTimeout(timeout)\r\n\t\t\ttimeout = setTimeout(inactivated, 400)\r\n\t\t\tvar y = (scrolled - pivot) * this.retractDirMod\r\n\t\t\ttotalScrolled = scrolled\r\n\t\t\tlastY = y\r\n\t\t\tconsole.log('onScroll', scrolled, pivot, '|', y)\r\n\t\t\tthisStyle.transform = `translate3d(0px, ${y}px, 0)`\r\n\t\t}\r\n\t\tthis.addScrollListeners(onScroll)\r\n\t\tthis.registerKillback(() => this.removeScrollListeners(onScroll))\r\n\t}\r\n*/\r\n}\r\n\r\nexport function getParallaxApplicator(node) {\r\n\tvar ratio = node.getAttribute('parallax')\r\n\tvar {style} = node\r\n\tif (ratio === 'custom')\r\n\t\treturn scrolled => console.warn('TODO: custom parallax')\r\n\telse {\r\n\t\tratio = -Number(ratio || 0.2)\r\n\t\treturn scrolled => style.transform = `translate3d(0, ${scrolled * ratio}px, 0)`\r\n\t}\r\n}","import {on, once, reflect, autobind, validate, observe} from 'ganymede'\r\n\r\n\r\n\r\nexport function isNodeAvailable(node) {\r\n\treturn !!node\r\n\t\t&& !node.disabled\r\n\t\t&& !isAttrBlocked(node, 'disabled')\r\n\t\t&& !isAttrBlocked(node, 'hidden')\r\n}\r\n\r\nfunction isAttrBlocked(node, attrName) {\r\n\tvar val = node.getAttribute(attrName)\r\n\tif (val === null) return false\r\n\tif (val === '') return true\r\n\tif (platform.screensize === 's' && val.includes('small'))  return true\r\n\tif (platform.screensize === 'm' && val.includes('medium')) return true\r\n\tif (platform.screensize === 'l' && val.includes('large'))  return true\r\n\treturn false\r\n}\r\n\r\nfunction selectedValidator(newIndex, self) {\r\n\tif (self.selected === newIndex)\r\n\t\treturn newIndex\r\n\tvar children = this.children\r\n\tif (self.children.length === 0)\r\n\t\treturn 0\r\n\tif (newIndex < 0) newIndex = 0\r\n\tif (newIndex > children.length -1) newIndex = children.length -1\r\n\tvar target = children[newIndex]\r\n\tif (isNodeAvailable(target)) {\r\n\t\treturn newIndex\r\n\t} else {\r\n\t\treturn self.selected\r\n\t}\r\n}\r\n\r\n\r\n\r\nexport let LinearSelectable = SuperClass => class extends SuperClass {\r\n\r\n\t@on('ready')\r\n\tonReady() {\r\n\t\t//console.log('LinearSelectable', this.children.length, this.children)\r\n\t\t//console.log('selected', this.querySelector('[selected]'))\r\n\t\tthis._selectedChanged(this.selected)\r\n\t}\r\n\r\n\t@validate(selectedValidator)\r\n\t@reflect\r\n\tselected = 0\r\n\r\n\t@observe('selected')\r\n\t_selectedChanged(newIndex, oldIndex) {\r\n\t\t//console.log('_selectedChanged', newIndex, oldIndex)\r\n\t\tif (this.activeTab)\r\n\t\t\tthis.activeTab.removeAttribute('selected')\r\n\t\tthis.activeTab = this.children[newIndex]\r\n\t\tif (this.activeTab)\r\n\t\t\tthis.activeTab.setAttribute('selected', '')\r\n\t\tthis.emit('selected', newIndex)\r\n\t}\r\n\r\n\r\n\tlinkToOtherSelectable(target) {\r\n\t\t//console.log('link', this, 'to target', target)\r\n\t\tthis.selected = target.selected\r\n\t\ttarget.on('selected', newIndex => {\r\n\t\t\t//console.log('target changed', newIndex)\r\n\t\t\tthis.selected = newIndex\r\n\t\t})\r\n\t\tthis.on('selected', newIndex => {\r\n\t\t\t//console.log('pages changed', newIndex)\r\n\t\t\ttarget.selected = newIndex\r\n\t\t})\r\n\t}\r\n\r\n\r\n\tselect(index) {\r\n\t\tthis.selected = index\r\n\t}\r\n\tprev() {\r\n\t\tthis.selected--\r\n\t}\r\n\tnext() {\r\n\t\tthis.selected++\r\n\t}\r\n\r\n\r\n}\r\n","import {on, once, reflect, autobind, validate, observe} from 'ganymede'\r\n\r\n\r\nexport let Visibility = SuperClass => class extends SuperClass {\r\n\r\n\t// todo implement visible in contrast to hidden\r\n\t// because some components that are usually hidden\r\n\t// need an explicit way to define they are visible\r\n\r\n\t@reflect hidden = Boolean\r\n\t@reflect visible = Boolean\r\n\r\n\t@once('ready')\r\n\tconfigureVisibilityAttributes() {\r\n\t\t//console.log('+++++ onready Visibility +++++')\r\n\t\t//console.log('this.visible', this.visible, this.hasAttribute('visible'))\r\n\t\t//console.log('this.hidden', this.hidden, this.hasAttribute('hidden'))\r\n\t\t// WARNING: at this point, attributes were read and if [visible] is defined\r\n\t\t//          both hidden and visible properties could be true. Setting hidden to false\r\n\t\t//          gets the ball rolling and keeps it properly synced\r\n\t\tif (this.visible)\r\n\t\t\tthis.hidden = false\r\n\t\telse if (this.hidden)\r\n\t\t\tthis.visible = false\r\n\t\t//console.log('this.visible', this.visible, this.hasAttribute('visible'))\r\n\t\t//console.log('this.hidden', this.hidden, this.hasAttribute('hidden'))\r\n\t}\r\n\r\n\t@observe('hidden')\r\n\thiddenChangedReflector() {\r\n\t\t//console.log('hiddenChanged to', this.hidden, '|', this.__preventHiddenFromUpdatingVisible)\r\n\t\tif (this.__preventHiddenFromUpdatingVisible === true) {\r\n\t\t\tthis.__preventHiddenFromUpdatingVisible = false\r\n\t\t} else {\r\n\t\t\tthis.__preventVisibleFromUpdatingHidden = true\r\n\t\t\t//console.log('setting visible to', !this.hidden)\r\n\t\t\tthis.visible = !this.hidden\r\n\t\t\tthis.__preventVisibleFromUpdatingHidden = false\r\n\t\t}\r\n\t}\r\n\t@observe('visible')\r\n\tvisibleChangedReflector() {\r\n\t\t//console.log('visibleChanged to', this.visible, '|', this.__preventVisibleFromUpdatingHidden)\r\n\t\tif (this.__preventVisibleFromUpdatingHidden === true) {\r\n\t\t\tthis.__preventVisibleFromUpdatingHidden = false\r\n\t\t} else {\r\n\t\t\tthis.__preventHiddenFromUpdatingVisible = true\r\n\t\t\t//console.log('setting hidden to', !this.visible)\r\n\t\t\tthis.hidden = !this.visible\r\n\t\t\tthis.__preventHiddenFromUpdatingVisible = false\r\n\t\t}\r\n\t}\r\n\r\n\t@autobind show() {\r\n\t\tthis.emit('show')\r\n\t}\r\n\r\n\t@autobind hide() {\r\n\t\tthis.emit('hide')\r\n\t}\r\n\r\n\t@autobind toggle() {\r\n\t\t//console.log('toggle', this.hidden, this.visible)\r\n\t\tif (this.hidden)\r\n\t\t\tthis.show()\r\n\t\telse\r\n\t\t\tthis.hide()\r\n\t}\r\n\r\n\t@autobind toggleVisibility() {\r\n\t\t//console.log('toggle', this.hidden, this.visible)\r\n\t\tif (this.hidden)\r\n\t\t\tthis.show()\r\n\t\telse\r\n\t\t\tthis.hide()\r\n\t}\r\n\r\n}\r\n","//import * as ganymede from 'ganymede'\r\nimport ganymede, {$$, $, emit} from 'ganymede'\r\nexport {$$, $, ready} from 'ganymede'\r\n// NOTE: Can't use 'export * from ganymede' because rollup is unable to resolve dependencies\r\n\r\nimport './theme'\r\nimport './battery'\r\n\r\nexport * from './appElement'\r\nexport * from './platform'\r\nexport * from './animation'\r\nexport * from './utils'\r\nexport * from './iridescent'\r\nexport * from './loader'\r\nexport * from './resizeDetector'\r\nexport * from './raf'\r\n\r\nexport * from './breakpoints'\r\nexport * from './Draggable'\r\nexport * from './Panel'\r\nexport * from './Scrollable'\r\nexport * from './LinearSelectable'\r\nexport * from './Visibility'\r\n\r\n//import {RenderManager} from './raf.js'\r\n//export var render = new RenderManager\r\n\r\n\r\n// ----------------------------------------------------------------------------------------------------------------------\r\n// --------------------------------------------- CORE -------------------------------------------------------------------\r\n// ----------------------------------------------------------------------------------------------------------------------\r\n\r\n/*\r\nfunction getFlexusPath() {\r\n\t// get attribute instead of property which would contain the whole origin with http://\r\n\tvar scriptPath = document.currentScript.getAttribute('src')\r\n\tconsole.log('scriptPath', scriptPath)\r\n\tif (scriptPath.includes('/')) {\r\n\t\tvar split = scriptPath.split('/')\r\n\t\tsplit.pop()\r\n\t\treturn split.join('/') + '/'\r\n\t} else {\r\n\t\treturn ''\r\n\t}\r\n}\r\n\r\nexport var flexusRootPath = getFlexusPath()\r\nexport var libPath = flexusRootPath + 'lib/'\r\nexport var elementsPath = flexusRootPath + 'elements/'\r\nexport var cssPath = flexusRootPath + 'css/'\r\n*/\r\n\r\n\r\nimport {platform} from './platform.js'\r\n\r\n\r\nfunction createMissingTag(tagName, idName, idValue, contentName, contentValue, override = false) {\r\n\tvar node = document.head.querySelector(`${tagName}[${idName}=\"${idValue}\"]`)\r\n\tif (node && !override) return\r\n\tif (!node) {\r\n\t\tnode = document.createElement(tagName)\r\n\t\tnode[idName] = idValue\r\n\t\tdocument.head.appendChild(node)\r\n\t}\r\n\tnode[contentName] = contentValue\r\n}\r\n\r\nfunction createMissingMeta(idName, contentName, override) {\r\n\tcreateMissingTag('meta', 'name', idName, 'content', contentName, override)\r\n}\r\nfunction createMissingLink(idName, contentName, override) {\r\n\tcreateMissingTag('link', 'rel', idName, 'href', contentName, override)\r\n}\r\n/*\r\nfunction createMissingMeta(name, content, override = false) {\r\n\tvar meta = document.head.querySelector(`meta[name=\"${name}\"]`)\r\n\tif (meta && !override) return\r\n\tif (!meta) {\r\n\t\tmeta = document.createElement('meta')\r\n\t\tmeta.name = name\r\n\t\tdocument.head.appendChild(meta)\r\n\t}\r\n\tmeta.content = content\r\n}\r\n*/\r\n// progressive web app\r\nexport var pwa = !platform.app\r\nexport var title = 'Flexus Test App'\r\nexport var description = 'Flexus description'\r\n\r\n//createMissingMeta('viewport', 'width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no')\r\ncreateMissingMeta('viewport', 'width=device-width, user-scalable=no')\r\n\r\n// give user time to opt out from setting up web app meta tags\r\nsetTimeout(() => {\r\n\tif (!pwa) return\r\n\t// NOTE: these do not override existing meta tags\r\n\tcreateMissingMeta('mobile-web-app-capable', 'yes')\r\n\tcreateMissingMeta('apple-mobile-web-app-capable', 'yes')\r\n\t//<meta name=\"apple-mobile-web-app-status-bar-style\" content=\"black\">\r\n\t//<meta name=\"msapplication-TileColor\" content=\"#2196F3\">//\r\n\r\n\tcreateMissingMeta('application-name', title)\r\n\tcreateMissingMeta('apple-mobile-web-app-title', title)\r\n\tcreateMissingMeta('description', description)\r\n\t// TODO title\r\n\tcreateMissingLink('manifest', 'manifest.json')\r\n}, 200)\r\n\r\n"],"names":["app","appElementReady","Promise","resolve","document","querySelector","listener","e","body","setAttribute","removeEventListener","addEventListener","ua","navigator","userAgent","platform","undefined","includes","Windows","window","customElements","constructor","name","csp","uwp","chromeapp","maxTouchPoints","touch","nontouch","inputType","determineFormfactor","phone","phablet","tablet","laptop","desktop","screensize","applyFormfactorAttributes","htmlNode","parentElement","removeAttribute","then","appElement","targetNode","hasAttribute","iridescent","hexToRgb","string","startsWith","slice","r","parseInt","substr","g","b","rgbToHex","int","toString","toUpperCase","rgbToHsl","max","Math","min","h","s","l","d","rgbForeground","count","brightness","rgbBrightness","rgbLuminance","rgbStrip","trim","split","map","Number","hex","endsWith","names","shades","loadPalette","rgbPalette","computed","getComputedStyle","Map","hslPalette","forEach","shade","rgb","getPropertyValue","hsl","set","closestPaletteColor","diff","value","colorName","rgbDifference","applyImageColor","img","target","type","promise","calculateImageColor","background","foreground","setPrimary","imgReady","vibrant","Vibrant","swatch","VibrantSwatch","calculateForegroundRgb","round","args","a","c","unpackArgs","toFixed","r1","g1","b1","r2","g2","b2","sumOfSquares","pow","sqrt","getMetaNode","meta","head","createElement","appendChild","content","match","backgroundRgb","foregroundRgb","setTypedColor","setAccent","backgroundRgbString","getRgbInsideString","style","setProperty","foregroundRgbString","setTint","matches","setColor","getRgbString","callback","reject","isImgLoaded","loadHandler","errorHandler","complete","naturalHeight","loadStyle","path","element","rel","href","media","onload","onerror","loadScript","src","relativePath","pop","length","push","join","rootPath","currentScript","getAttribute","isLoaded","partialPath","Array","from","scripts","some","script","loadPolyfill","root","scopePoly","Element","prototype","after","animate","all","awaitPromises","loadNeon","$","icons","css","material","neon","remove","loadMaterial","swapDesign","warn","swapTheme","darks","$$","lights","node","ViewManagement","UI","uiViewSettings","UIViewSettings","getForCurrentView","systemNavigationManager","Core","SystemNavigationManager","uiSettings","UISettings","UserInteractionMode","UIColorType","loadDesign","design","designLoaded","loadPlatformDesign","windows","detectLoadedDesign","styleSheets","detectNodeDesign","detectTheme","theme","applyDesignAttrs","applyThemeAttrs","applyPrimary","fromNode","primary","color","applyHexColorToNode","detectUwpTheme","bg","getColorValue","isDark","log","detectUwpColor","accent","primaryElement","querySelectorAll","effectSuppresion","batteryWise","cpuWise","hardwareConcurrency","minCpuCores","update","batteryUpdated","level","charging","batteryLevel","web","getBattery","battery","check","styleEl","id","styleSheet","sheet","addReadyAnimation","tagName","addRule","traverse","startNode","condition","traverseValue","result","runAll","array","i","clamp","num","mapRange","in_min","in_max","out_min","out_max","isTouchEvent","sourceCapabilities","firesTouchEvents","pointerType","matchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","webkitMatchesSelector","ownerDocument","item","draggable","ClassOrElement","handlersSource","bindingTarget","orientation","handlers","call","attachToInstance","startHandler","moveHandler","endHandler","bindTo","bind","onDragStart","registerKillback","stopPropagation","preventDefault","onDragMove","onDragEnd","pythagorean","durationByDistance","distance","eventPositionInContainer","container","containerBbox","getBoundingClientRect","x","left","y","top","width","height","nodePositionInContainer","nodeBbox","animation","position","offsetWidth","offsetHeight","Event","duration","_calculate","_setup","visibility","finished","clipPath","opacity","transform","children","localName","anim","halfDuration","visibleState","slideOutState","slideInState","transitionDelay","onfinish","transition","to","easing","display","values","keep","key","prop","Object","keys","abs","player","ResizeObserver","ro","entries","entry","onresize","onResize","setupWatchElement","obj","data","right","bottom","overflow","pointerEvents","zIndex","watchElement","contentDocument","defaultView","resizeRAF","diyDetector","object","watchesGlobalResize","listenTarget","resizeCallback","cancelAnimationFrame","requestAnimationFrame","listenObjectView","start","innerWidth","setupDetector","observe","resizeDetector","ClassOrCondition","init","Class","rafThrottle","latestArg","running","run","arg","screensizes","SMALL","MEDIUM","LARGE","SCREENSIZE","screenSizeFlags","matchFormFactorDef","def","ss","makeFirstQuery","makeLastQuery","makeStepQuery","makeBreakpointQueries","breakpoints","filter","queries","lastIndex","registerQueries","onAlways","onUpdate","attrName","attrValues","query","registerQuery","attrValue","mql","matchMedia","killback","removeListener","addListener","attrVal","documentReady","ganymede","ready","portrait","landscape","applyQuery","debounceMap","debounceEmit","eventName","debounceTimeout","get","setTimeout","emitUpdateScreensize","emitUpdateOrientation","setupLocalBreakpointQueries","sm","ml","documentElement","Breakpointable","SuperClass","breakpointState","emitUpdate","emit","killbacks","reflect","S","M","L","TOP","RIGHT","BOTTOM","LEFT","NO_DIR","Draggable","once","dragThresholdDisable","dragThreshold","dragPercentage","dragDirMod","dragUp","dragRight","dragDown","dragLeft","dragOrientation","setupDraggableDirection","setupDraggableHandlers","setupDraggableThreshold","dragRender","on","dragThresholdTarget","dragMoved","dragSkipFirstMoveBeforeCancel","dragStartHandler","dragMoveHandler","dragEndHandler","totalDistance","getDragDistance","initDragPosition","getDragPosition","dragInitPercentage","dragged","percentage","_dragRender","_dragRenderHorizontal","_dragRenderVertical","dismissable","String","autobind","isDescendant","parent","child","parentNode","overlayMaxOpacity","Panel","defaultValue","self","panel","hasOverlayBg","overlayBg","__overlayBgDefault","autoAssignPosition","isForciblyVisible","visible","isForciblyHidden","hidden","autoShow","autoHide","pinned","pinnable","setupDragOverlay","dragEdge","setupDragEdge","applyDragVisibleState","attachInvokerListeners","pinnedChanged","applyVisibilityState","next","nextElementSibling","prev","previousElementSibling","_attachInvokerListeners","nodes","toggle","overlayElement","show","hide","applyDragHiddenState","onPinPanel","onUnpinPanel","onHidePanel","onShowPanel","canDragUp","canDragRight","canDragDown","canDragLeft","createOverlay","overlayFade","onOverlayClick","dragstart","drag","dragend","off","edgeElement","Boolean","overlayForElement","overlay","className","before","val","Scrollable","scrollTarget","scrollListeners","isScrolledToTop","isScrolledToBottom","scrollReflectsTouchAction","listeners","onScrollChange","updateTouchAction","executeScrollThrottled","scrolled","startScrollListening","scrollListenerActive","passive","index","indexOf","splice","endScrollListening","isContentScrollable","reflectTouchAction","maxScrollable","touchAction","scrollTop","scrollHeight","UP","DOWN","Retractable","retractDirMod","getParallaxApplicator","ratio","console","isNodeAvailable","disabled","isAttrBlocked","selectedValidator","newIndex","selected","LinearSelectable","validate","_selectedChanged","oldIndex","activeTab","Visibility","__preventHiddenFromUpdatingVisible","__preventVisibleFromUpdatingHidden","createMissingTag","idName","idValue","contentName","contentValue","override","createMissingMeta","createMissingLink","pwa","title","description"],"mappings":"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"}