{"version":3,"file":"ganymede.js","sources":["src/lib/ganymede/util.js","src/lib/ganymede/metadata.js","src/lib/ganymede/sync.js","src/lib/ganymede/events.js","src/lib/ganymede/template.js","src/lib/ganymede/decorators.js","src/lib/ganymede/ganymede.js"],"sourcesContent":["export var $ = document.querySelector.bind(document)\r\nexport var $$ = selector => Array.from(document.querySelectorAll(selector))\r\n\r\nexport function camelToKebab(string) {\r\n\treturn string.split(/(?=[A-Z])/).join('-').toLowerCase()\r\n}\r\n\r\nexport function kebabToCamel(string) {\r\n\treturn string.replace(/-([a-z])/g, g => g[1].toUpperCase())\r\n}\r\n\r\nexport function runAll(iterable) {\r\n\titerable.forEach(fc => fc())\r\n}","import {camelToKebab, kebabToCamel} from './util'\r\n\r\n\r\nvar meta = Symbol('Metadata')\r\n\r\nexport function getMetadata(Class) {\r\n\tif (!Class[meta])\r\n\t\tClass[meta] = new Metadata(Class)\r\n\treturn Class[meta]\r\n}\r\n\r\nclass Metadata {\r\n\t// TODO: Let the class extend Map instead of using this map\r\n\t//       when extending builtins is implemented in browsers\r\n\tproperties = new Map\r\n\tattributes = new Map\r\n\r\n\ttemplate = undefined\r\n\t//reflections = []\r\n\tinitializers = []\r\n\tscheduledEvents = []\r\n\tscheduledOnce = []\r\n\r\n\tconstructor(Class) {\r\n\t\t// TODO clone inherited metadata\r\n\t\t//var Super = Object.getPrototypeOf(Class)\r\n\t\t//Class[meta] = Metadata.clone(Super[meta])\r\n\t\tthis.className = Class.name\r\n\t\tthis.elementName = camelToKebab(Class.name)\r\n\t}\r\n\r\n\tget(propName) {\r\n\t\treturn this.getProp(propName)\r\n\t}\r\n\r\n\t_createPropAttr(propName, attrName) {\r\n\t\tvar propMeta = new PropAttrMeta(propName, attrName)\r\n\t\tthis.properties.set(propName, propMeta)\r\n\t\tthis.attributes.set(attrName, propMeta)\r\n\t\treturn propMeta\r\n\t}\r\n\r\n\tgetProp(propName) {\r\n\t\tif (!this.properties.has(propName))\r\n\t\t\treturn this._createPropAttr(propName, camelToKebab(propName))\r\n\t\telse\r\n\t\t\treturn this.properties.get(propName)\r\n\t}\r\n\r\n\tgetAttr(attrName) {\r\n\t\tif (!this.attributes.has(attrName))\r\n\t\t\treturn this._createPropAttr(kebabToCamel(attrName), attrName)\r\n\t\telse\r\n\t\t\treturn this.attributes.get(attrName)\r\n\t}\r\n\r\n\tforEach(callback) {\r\n\t\tthis.properties.forEach(callback)\r\n\t}\r\n\r\n}\r\n\r\nclass PropAttrMeta {\r\n\r\n\tconstructor(propName, attrName) {\r\n\t\tthis.propName = propName\r\n\t\tthis.attrName = attrName\r\n\t\tthis.symbol = Symbol(propName)\r\n\t}\r\n\r\n\tobservers = []\r\n\ttype = undefined\r\n\treflect = false\r\n\treflectSkip = false\r\n\tdeserializeSkip = false\r\n\tgetsetAttached = false\r\n\t// original getter/setter of the property\r\n\tgetter = undefined\r\n\tsetter = undefined\r\n\r\n\t// comes from descriptor.initializer() to determine initial value or type\r\n\tinitValue = undefined\r\n\t// comes from @defaultValue descriptor and only assigns value if initial is undefined\r\n\tdefaultValue = undefined\r\n}","import {getMetadata} from './metadata'\r\n\r\n\r\n// property decorator\r\n\r\nexport function reflect(ClassProto, propName, descriptor) {\r\n\t//console.log('reflect', propName)\r\n\tvar Class = ClassProto.constructor\r\n\tvar meta = getMetadata(Class)\r\n\tvar propMeta = meta.get(propName)\r\n\tpropMeta.reflect = true\r\n\t// register attribute for observation in custom elements API\r\n\tClass.observedAttributes.push(propName)\r\n\r\n\t// type of initializer properties can be discovered before registration\r\n\t// Note: can't do the same with getters. Their value is accessible after instatiation\r\n\tif (descriptor.initializer) {\r\n\t\tvar initValue = descriptor.initializer()\r\n\t\t//console.log('initValue', propName, initValue)\r\n\t\tdescriptor.initializer = undefined\r\n\t\tdescriptor.writable = true\r\n\t\tif (!determineType(initValue, propMeta))\r\n\t\t\tinitValue = undefined\r\n\t\tmeta.initializers.push(context => context[propMeta.symbol] = initValue)\r\n\t}\r\n\t//return setupGetSet(ClassProto, descriptor, propMeta, meta)\r\n\t//console.log('setupGetSet (reflect)', propName, propMeta.getsetAttached)\r\n\tvar output = setupGetSet(ClassProto, descriptor, propMeta, meta)\r\n\tObject.defineProperty(ClassProto, propName, output)\r\n\treturn output\r\n}\r\n\r\n// decorator\r\nexport function defaultValue(value) {\r\n\treturn (ClassProto, propName, descriptor) => {\r\n\t\tvar Class = ClassProto.constructor\r\n\t\tvar meta = getMetadata(Class)\r\n\t\tvar propMeta = meta.get(propName)\r\n\t\tpropMeta.defaultValue = value\r\n\t\tif (descriptor.initializer === null)\r\n\t\t\tdescriptor.initializer = () => value.constructor\r\n\t}\r\n}\r\n\r\n\r\nexport function setupPropertyObservers(meta, Class) {\r\n\tvar ClassProto = Class.prototype\r\n\r\n\t// automatically turn all methods ending with 'Changed' into observer\r\n\tObject.getOwnPropertyNames(ClassProto).forEach(methodName => {\r\n\t\t// only focus at methods ending with 'Changed'\r\n\t\tif (!methodName.endsWith('Changed')) return\r\n\t\t// register method as observer in metadata\r\n\t\tvar propName = methodName.slice(0, -7)\r\n\t\tvar propMeta = meta.get(propName)\r\n\t\tif (!propMeta.observers.includes(methodName))\r\n\t\t\tpropMeta.observers.push(methodName)\r\n\t})\r\n\r\n\t// attach the actual listeners\r\n\tmeta.forEach(propMeta => {\r\n\t\tif (propMeta.observers.length === 0) return\r\n\t\tvar {propName} = propMeta\r\n\t\t// extend property into get/set\r\n\t\tvar descriptor = Object.getOwnPropertyDescriptor(ClassProto, propName)\r\n\t\tif (!descriptor) descriptor = getDefaultDescriptor()\r\n\t\t//if (descriptor.configurable === false) return\r\n\t\t//console.log('setupGetSet (setupPropertyObservers)', propName, propMeta.getsetAttached)\r\n\t\tif (!propMeta.getsetAttached) {\r\n\t\t\tdescriptor = setupGetSet(ClassProto, descriptor, propMeta, meta)\r\n\t\t\tObject.defineProperty(ClassProto, propName, descriptor)\r\n\t\t}\r\n\t})\r\n}\r\n\r\nfunction getDefaultDescriptor() {\r\n\treturn {\r\n\t\tvalue: undefined,\r\n\t\tenumerable: true,\r\n\t\twritable: true,\r\n\t\tconfigurable: true\r\n\t}\r\n}\r\n\r\n\r\nexport function setupReflection(meta, Class) {\r\n\t//var oldCallback = Class.prototype.attributeChangedCallback\r\n\tClass.prototype.attributeChangedCallback = function(attrName, oldValue, newValue) {\r\n\t\tdeserializeAttribute(this, meta.get(attrName))\r\n\t\t//if (oldCallback) oldCallback.call(this, attrName, oldValue, newValue)\r\n\t}\r\n}\r\n\r\nexport function setupInstanceReflection(element, meta) {\r\n\tmeta.initializers.forEach(initializer => initializer(element))\r\n\t\t\r\n\tmeta.forEach(propMeta => {\r\n\t\tif (propMeta.reflect) {\r\n\t\t\tif (propMeta.type === Boolean) {\r\n\t\t\t\t// short circuit the deserialization if type is Boolean\r\n\t\t\t\t// and shortcut for 'false' value is present.\r\n\t\t\t\t// That is: attribute name with 'no' or 'not' prefix\r\n\t\t\t\t// therefore no-attribute-name\r\n\t\t\t\t// instead of the attribute-name=\"false\"\r\n\t\t\t\tif (element.hasAttribute(`not-${propMeta.attrName}`)) {\r\n\t\t\t\t\telement.removeAttribute(`not-${propMeta.attrName}`)\r\n\t\t\t\t\telement.setAttribute(propMeta.attrName, 'false')\r\n\t\t\t\t}\r\n\t\t\t\tif (element.hasAttribute(`no-${propMeta.attrName}`)) {\r\n\t\t\t\t\telement.removeAttribute(`no-${propMeta.attrName}`)\r\n\t\t\t\t\telement.setAttribute(propMeta.attrName, 'false')\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// Deserialize is called even though there might be no attribute on element\r\n\t\t\t// and that's because of setting types and initializing everything correctly\r\n\t\t\tvar initAttrValue = _deserialize(element, propMeta, true)\r\n\t\t\t// WARNING: Third parameter kicks off the deserializeSkip/reflectSkip manually\r\n\t\t\t// if element initial doesn't have the attribute to deserialize\r\n\t\t\t// It's because attributeChangedCallback() gets fired only after existing attribute has changed\r\n\t\t\t// and this throws off the deserializeSkip/reflectSkip lifecycle\r\n\t\t\t_reflect(element, propMeta, initAttrValue !== null)\r\n\t\t} else if (propMeta.observers.length) {\r\n\t\t\t// type of getter can only be discovered after instatiation (not during registration)\r\n\t\t\tvar value = element[propMeta.propName]\r\n\t\t\tdetermineType(value, propMeta)\r\n\t\t}\r\n\t})\r\n}\r\n\r\nexport function setupDefaultValues(element, meta) {\r\n\tmeta.properties.forEach(({propName, defaultValue}) => {\r\n\t\tif (defaultValue === undefined) return\r\n\t\telement[`_${propName}Default`] = defaultValue\r\n\t\tif (element[propName] === undefined)\r\n\t\t\telement[propName] = defaultValue\r\n\t})\r\n}\r\n\r\n\r\n\r\nfunction setupGetSet(ClassProto, descriptor, propMeta, meta) {\r\n\tvar {propName, reflect, observers, symbol} = propMeta\r\n\r\n\t//if (propMeta.getsetAttached)\r\n\t//\treturn Object.getOwnPropertyDescriptor(ClassProto, propName) || descriptor\r\n\t//if (propMeta.getsetAttached) return descriptor\r\n\r\n\t//console.log('setupGetSet', propName, propMeta)\r\n\tif (descriptor.get && descriptor.set) {\r\n\t\t// decorated property is already a getter/setter\r\n\t\tvar getter = descriptor.get\r\n\t\tvar setter = descriptor.set\r\n\t} else {\r\n\t\tvar symbol = propMeta.symbol\r\n\t\tvar getter = function() {\r\n\t\t\treturn this[symbol]\r\n\t\t}\r\n\t\tvar setter = function(newValue) {\r\n\t\t\tthis[symbol] = newValue\r\n\t\t}\r\n\t}\r\n\r\n\tfunction set(newValue) {\r\n\t\t//console.log('_set', propName, newValue)\r\n\t\t// preventing infinite loop that NaN tends to ends up in\r\n\t\tif (Number.isNaN(newValue) && Number.isNaN(value))\r\n\t\t\treturn value = NaN\r\n\t\tvar oldValue = getter.call(this)\r\n\t\tif (oldValue === newValue)\r\n\t\t\treturn\r\n\t\tsetter.call(this, newValue)\r\n\t\tif (reflect)\r\n\t\t\treflectProperty(this, propMeta)\r\n\r\n\t\t//console.log('SETTER', propName, newValue)\r\n\r\n\t\t// call observers if there are any. And do so only after element is constructed\r\n\t\t// (ignore all observers during bootrapping the deserialize/reflect phase)\r\n\t\tif (observers.length && meta.constructed)\r\n\t\t\tobservers.forEach(observerName => this[observerName](newValue, oldValue))\r\n\t}\r\n\r\n\tpropMeta.getsetAttached = true\r\n\r\n\treturn {\r\n\t\tconfigurable: true,\r\n\t\tget: getter,\r\n\t\tset,\r\n\t}\r\n}\r\n\r\n\r\n// returns bool isPrimitive\r\nfunction determineType(value, propMeta) {\r\n\tif (value !== undefined && value !== null && value.constructor !== Function) {\r\n\t\tpropMeta.type = value.constructor\r\n\t\treturn true\r\n\t} else {\r\n\t\tpropMeta.type = value\r\n\t\treturn false\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n// ----------------------------------------------------------------------------------------------------------------------\r\n// ------------------------------ ELEMENT ATTRIBUTE TO OBJECT PROPERTY DESERIALIZATION ---------------------------------------------------\r\n// ----------------------------------------------------------------------------------------------------------------------\r\n\r\n\r\nfunction deserializeAttribute(element, propMeta) {\r\n\t//console.log('deserialize', propMeta.propName, propMeta.deserializeSkip ? 'SKIP' : 'OK')\r\n\tif (propMeta.deserializeSkip)\r\n\t\tpropMeta.deserializeSkip = false\r\n\telse\r\n\t\t_deserialize(element, propMeta)\r\n}\r\n\r\nfunction _deserialize(element, propMeta, avoidIfHasValue = false) {\r\n\t//console.log('_deserialize', propMeta.propName)\r\n\t// prevent endless loop by preventing next reflection (which will be triggered by this deserialization)\r\n\tvar {propName, type} = propMeta\r\n\tvar attrValue = element.getAttribute(propMeta.attrName)\r\n\t//console.log('attrValue', attrValue)\r\n\t//console.log('DESERIALIZE', propMeta.type, propName, attrValue)\r\n\t//var propValue = element[propName]\r\n\t//if (avoidIfHasValue && propValue !== undefined && attrValue === null) return\r\n\tif (avoidIfHasValue && attrValue === null) return attrValue\r\n\t//console.log('reflectSkip', propMeta.propName)\r\n\t// prevent reactiong (setting value will trigget setter which will trigger reflection)\r\n\tpropMeta.reflectSkip = true\r\n\tif (type === Boolean) {\r\n\t\tif (attrValue !== 'false' && attrValue !== null) {\r\n\t\t\t//console.log('XXX A', propName, true)\r\n\t\t\telement[propName] = true\r\n\t\t} else {\r\n\t\t\t//console.log('XXX B')\r\n\t\t\telement[propName] = false\r\n\t\t}\r\n\t} else if (type === Number) {\r\n\t\telement[propName] = attrValue === null ? undefined : +attrValue || 0\r\n\t} else if (type === String) {\r\n\t\telement[propName] = attrValue === null ? undefined : attrValue\r\n\t} else {\r\n\t\t// custom type handler\r\n\t\ttype(element, propName, attrValue)\r\n\t}\r\n\t// all synchronous reactions were prevented at this point, reset\r\n\tpropMeta.reflectSkip = false\r\n\treturn attrValue\r\n}\r\n\r\n\r\n// ----------------------------------------------------------------------------------------------------------------------\r\n// ------------------------------ PROPERTY TO ELEMENT ATTRIBUTE REFLECTION ---------------------------------------------------\r\n// ----------------------------------------------------------------------------------------------------------------------\r\n\r\nfunction reflectProperty(element, propMeta) {\r\n\t//console.log('reflect', propMeta.propName, propMeta.reflectSkip ? 'SKIP' : 'OK')\r\n\t//console.log('reflectProperty', propMeta.propName, propMeta.attrName, '|', propMeta.reflectSkip ? 'SKIP' : 'PASS')\r\n\tif (propMeta.reflectSkip)\r\n\t\tpropMeta.reflectSkip = false\r\n\telse\r\n\t\t_reflect(element, propMeta)\r\n}\r\nfunction _reflect(element, propMeta, canSkipDeserialize = true) {\r\n\t//console.log('_reflect', propMeta.propName, '|', canSkipDeserialize)\r\n\t// prevent endless loop by preventing next deserialization (which will be triggered by this reflection)\r\n\tpropMeta.deserializeSkip = canSkipDeserialize\r\n\tvar attrName = propMeta.attrName\r\n\tvar propValue = element[propMeta.propName]\r\n\t//console.log('reflect', attrName, propValue)\r\n\tif (propValue === undefined) {\r\n\t\telement.removeAttribute(attrName)\r\n\t\treturn\r\n\t}\r\n\tif (propValue === true)\r\n\t\telement.setAttribute(attrName, '')\r\n\telse if (propValue === false)\r\n\t\telement.removeAttribute(attrName)\r\n\telse\r\n\t\telement.setAttribute(attrName, propValue)\r\n}\r\n","import {runAll} from './util'\r\nimport {getMetadata} from './metadata'\r\n\r\n\r\n// property decorator: add method as event listener (to instance or given node or path to node)\r\nexport function on(...args) {\r\n\tvar eventName = args.pop()\r\n\t// if only event was given, pass it directly to Ganymedes scheduleEvent\r\n\t/*if (args.length === 0) {\r\n\t\t// Only event name was given (as a single argument)\r\n\t\treturn (ClassProto, callbackName) => {\r\n\t\t\tconsole.log('---', eventName, callbackName, ClassProto[callbackName])\r\n\t\t\tscheduleEvent(ClassProto.constructor, eventName, ClassProto[callbackName])\r\n\t\t}\r\n\t}*/\r\n\t// condition was possibly given to determine wheter to attach listener\r\n\t// to given class instance\r\n\tif (typeof eventName === 'function') {\r\n\t\tvar condition = eventName\r\n\t\teventName = args.pop()\r\n\t}\r\n\t// Two arguments were given.\r\n\t// First arg is path to element on which to listen the event\r\n\t// (for example '$.myid' matches 'this.$.myid')\r\n\t// or the element itself (not related to instace, something like window/document, etc...)\r\n\t// Second one is the eventName\r\n\tvar nodeOrPath = args[0]\r\n\tif (typeof nodeOrPath === 'string') {\r\n\t\tvar nodePath = nodeOrPath\r\n\t\tvar globalNode\r\n\t} else {\r\n\t\tvar nodePath\r\n\t\tvar globalNode = nodeOrPath\r\n\t}\r\n\tvar nodePath = typeof nodeOrPath === 'string' ? nodeOrPath : undefined\r\n\treturn (ClassProto, callbackName) => {\r\n\t\tvar errorMsg = `ganymede: unable to attach @on event listener for ${ClassProto.constructor.name}#${nodePath} because node path is undefined`\r\n\t\t// wait for creation of element, to populate shadowRoot nodes\r\n\t\tscheduleOnce(ClassProto.constructor, 'connected', function() {\r\n\t\t//scheduleEvent(ClassProto.constructor, 'created', function() {\r\n\t\t\t// node is either given (something not related to instance like window/document)\r\n\t\t\t// or path to the node is (like 'nextElementSibling')\r\n\t\t\t// or nothing is given and target is the custom element itself (at this point\r\n\t\t\t// it must be because of the condition)\r\n\t\t\tvar node = globalNode || (nodePath ? traverseNodePath(this, nodePath) : this)\r\n\t\t\tif (node) {\r\n\t\t\t\tattachEvent(this, node, callbackName, eventName, condition)\r\n\t\t\t} else if (nodePath) {\r\n\t\t\t\t// something went wrong, unable to attach\r\n\t\t\t\tif (nodePath.includes('.')) {\r\n\t\t\t\t\tthrow Error(errorMsg)\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// path is not deep so we could try to wait for the ready event and try again\r\n\t\t\t\t\tthis.once('ready', () => {\r\n\t\t\t\t\t\tnode = traverseNodePath(this, nodePath)\r\n\t\t\t\t\t\tif (node)\r\n\t\t\t\t\t\t\tattachEvent(this, node, callbackName, eventName, condition)\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tthrow Error(errorMsg)\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n}\r\n\r\n// property decorator: \r\nexport function once(...args) {\r\n\tconsole.warn(`ganymede: @once decorator is not yet implemented`)\r\n\treturn on(...args)\r\n}\r\n\r\nexport function promiseOnce(target, eventName, condition, rejectIfNotMet = false) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\ttarget.addEventListener(eventName, () => {\r\n\t\t\tif (condition) {\r\n\t\t\t\tif (condition()) {\r\n\t\t\t\t\tresolve()\r\n\t\t\t\t} else if (rejectIfNotMet) {\r\n\t\t\t\t\treject()\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tresolve()\r\n\t\t\t}\r\n\t\t})\r\n\t})\r\n}\r\n\r\nfunction traverseNodePath(context, nodePath) {\r\n\tvar node\r\n\tif (nodePath.includes('.')) {\r\n\t\tvar pathSplit = nodePath.split('.') // path to element in shadowRoot like '$.myid' for 'this.$.myid'\r\n\t\tvar pathStep\r\n\t\tnode = context\r\n\t\twhile (pathStep = pathSplit.shift()) {\r\n\t\t\tnode = node[pathStep]\r\n\t\t}\r\n\t} else {\r\n\t\tnode = context[nodePath]\r\n\t}\r\n\treturn node\r\n}\r\n\r\n// Returns true if attaching event was successful\r\n// Returns false if could not attach due to false condition\r\nfunction attachEvent(context, node, callbackName, eventName, condition) {\r\n\tif (condition && !condition(context)) return false\r\n\tvar listener = context[callbackName].bind(context)\r\n\tnode.addEventListener(eventName, e => listener(e.detail, e))\r\n\tcontext.registerKillback(() => node.removeEventListener(eventName, listener))\r\n\treturn true\r\n}\r\n\r\n// Decorators can't access instance but sometimes need to (hook up event listener).\r\n// This schedules event callback in a hidden queue and those will be attached on instantiation\r\nexport function scheduleEvent(Class, eventName, callback) {\r\n\tgetMetadata(Class).scheduledEvents.push([eventName, callback])\r\n}\r\nexport function scheduleOnce(Class, eventName, callback) {\r\n\tgetMetadata(Class).scheduledOnce.push([eventName, callback])\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n// General Purpose Killbacks\r\nvar GPKillbacks = Symbol('GPKillbacks')\r\n\r\nfunction registerKillback(killback) {\r\n\tthis[GPKillbacks].add(killback)\r\n}\r\n\r\n// NOTE: this is made to be extendable class as well as decorator.\r\n// It could be exported but is not now and is instead built into every element\r\n\r\n// EventEmitter Killbacks\r\nvar EEKillbacks = Symbol('EEKillbacks')\r\n\r\nfunction DOMEventEmitter() {\r\n\tthis[EEKillbacks] = new Map\r\n}\r\n\r\n// args: [target], eventName, listener\r\n// by default events on 'this' are listened but sometimes the nice syntax of on()\r\n// and killbacks is nice to use elsewhere (like on children)\r\nDOMEventEmitter.prototype.on = function(...args) {\r\n\tvar listener = args.pop()\r\n\tvar eventName = args.pop()\r\n\tvar target = args.length ? args.pop() : this\r\n\t// binding in advance (instead of doing #call every time event gets fired) for efficiency\r\n\tvar boundListener = listener.bind(this)\r\n\tif (eventName === 'change') {\r\n\t\tvar callback = e => {\r\n\t\t\t// preventing bubbling 'change' event from children (like checkboxes) \r\n\t\t\tif (e.target !== this) return\r\n\t\t\tboundListener(e.detail, e)\r\n\t\t}\r\n\t} else {\r\n\t\tvar callback = e => boundListener(e.detail, e)\r\n\t}\r\n\tvar killback = () => {\r\n\t\ttarget.removeEventListener(eventName, callback)\r\n\t\tthis[EEKillbacks].delete(listener)\r\n\t}\r\n\ttarget.addEventListener(eventName, callback)\r\n\tthis[EEKillbacks].set(listener, killback)\r\n}\r\n\r\nDOMEventEmitter.prototype.once = function(eventName, listener) {\r\n\tvar callback = e => {\r\n\t\t//if (e.target !== this) return\r\n\t\tlistener.call(this, e.detail, e)\r\n\t\tkillback()\r\n\t}\r\n\tvar killback = () => {\r\n\t\tthis.removeEventListener(eventName, callback)\r\n\t\tthis[EEKillbacks].delete(listener)\r\n\t}\r\n\tthis.addEventListener(eventName, callback)\r\n\tthis[EEKillbacks].set(listener, killback)\r\n}\r\n\r\nDOMEventEmitter.prototype.off = function(eventName, listener) {\r\n\tvar killback = this[EEKillbacks].get(listener)\r\n\tif (killback) {\r\n\t\tkillback()\r\n\t\tthis[EEKillbacks].delete(listener)\r\n\t}\r\n}\r\n\r\n// simple wrapper for dispatchEvent\r\nexport function emit(node, eventName, data) {\r\n\tif (data !== undefined)\r\n\t\tvar event = new CustomEvent(eventName, {detail: data})\r\n\telse\r\n\t\tvar event = new Event(eventName)\r\n\tnode.dispatchEvent(event)\r\n}\r\n\r\n\r\n\r\nexport function setupEventListeners(element, meta) {\r\n\t// add general purpose killbacks registry\r\n\telement[GPKillbacks] = new Set\r\n\telement.registerKillback = registerKillback.bind(element)\r\n\t// mixin EventEmitter prototype if allowed\r\n\tif (!meta.preventEventEmitter) {\r\n\t\telement.on = DOMEventEmitter.prototype.on.bind(element)\r\n\t\telement.once = DOMEventEmitter.prototype.once.bind(element)\r\n\t\telement.off = DOMEventEmitter.prototype.off.bind(element)\r\n\t\telement.emit = emit.bind(element, element)\r\n\t\tDOMEventEmitter.call(element)\r\n\t\t// assign waiting events requested by decorators (which are called before instatiation)\r\n\t\t// sidenote: these listeners might need to be bound or #called\r\n\t\tmeta.scheduledEvents.forEach(([name, listener]) => element.on(name, listener))\r\n\t\tmeta.scheduledOnce.forEach(([name, listener]) => element.once(name, listener))\r\n\t} else {\r\n\t\t// assign waiting events requested by decorators (which are called before instatiation)\r\n\t\t// sidenote: these listeners might need to be bound or #called\r\n\t\t//_.forEach(meta.scheduledEvents, ([name, listener] = data) => {\r\n\t\tmeta.scheduledEvents.forEach(([name, listener]) => {\r\n\t\t\telement.addEventListener(name, listener)\r\n\t\t\telement.registerKillback(() => element.removeEventListener(name, listener))\r\n\t\t})\r\n\t\t// TODO once\r\n\t}\r\n}\r\n\r\n\r\nexport function killEventListeners(element, meta) {\r\n\t// kill general purpose killbacks\r\n\trunAll(element[GPKillbacks])\r\n\t// mixin EventEmitter prototype if allowed\r\n\tif (!meta.preventEventEmitter)\r\n\t\trunAll(element[EEKillbacks])\r\n}","import {getMetadata} from './metadata'\r\n\r\n\r\n//var polyfillShadowCss = window.ShadyCSS && navigator.userAgent.includes('Edge')\r\n\r\n// creates shadow dom inside element and injects template into it\r\nexport function setupTemplate(element, meta) {\r\n\tvar clonedTemplate = document.importNode(meta.template.content, true)\r\n\telement.attachShadow({mode: 'open'})\r\n\telement.shadowRoot.appendChild(clonedTemplate)\r\n\tif (window.ShadyCSS && ShadyCSS.styleElement)\r\n\t\tShadyCSS.styleElement(element)\r\n\telse if (window.ShadyCSS && ShadyCSS.applyStyle)\r\n\t\tShadyCSS.applyStyle(element)\r\n}\r\n\r\n// find all elements with id inside shadowRoot and assign them to element.$\r\nexport function createIdList(element) {\r\n\tvar $ = element.$ = {}\r\n\tif (element.shadowRoot == null) return\r\n\tArray.from(element.shadowRoot.querySelectorAll('[id]'))\r\n\t\t.forEach(element => {\r\n\t\t\t$[element.id] = element\r\n\t\t})\r\n}\r\n\r\n\r\n// ------------------------------------- DECORATORS ------------------------------------------\r\n\r\n// created template element out of given template string (for performance)\r\n// and also polyfills styles for older browsers\r\nexport function solidifyTemplate(meta) {\r\n\tif (!(meta.templateString || meta.styleString)) return\r\n\tmeta.template = document.createElement('template')\r\n\tmeta.template.innerHTML = (meta.styleString || '') + (meta.templateString || '<slot></slot>')\r\n\tif (window.ShadyCSS)\r\n\t\twindow.ShadyCSS.prepareTemplate(meta.template, meta.elementName)\r\n}\r\n\r\n// class decorator: attaches shadow dom template string to the class\r\nexport function template(templateString) {\r\n\treturn Class => {\r\n\t\tvar meta = getMetadata(Class)\r\n\t\tmeta.templateString = templateString\r\n\t}\r\n}\r\n\r\n// class decorator: attaches css stylesheet to the class\r\nexport function css(urlOrStyle) {\r\n\treturn Class => {\r\n\t\tvar meta = getMetadata(Class)\r\n\t\tif (urlOrStyle.includes('.css')) {\r\n\t\t\tmeta.styleString = `<style>@import '${urlOrStyle}';</style>`\r\n\t\t} else {\r\n\t\t\tmeta.styleString = `<style>${urlOrStyle}</style>`\r\n\t\t}\r\n\t}\r\n}","import {getMetadata} from './metadata'\r\nimport {scheduleEvent} from './events'\r\n\r\n\r\nexport function nonenumerable(target, name, descriptor) {\r\n\tdescriptor.enumerable = false\r\n\treturn descriptor\r\n}\r\n\r\n// method decorator\r\n// example: @observe('firstName', 'lastName') printName() {...}\r\nexport function observe(...observedProperties) {\r\n\treturn function(ClassProto, callbackName) {\r\n\t\tvar meta = getMetadata(ClassProto.constructor)\r\n\t\tobservedProperties.forEach(propName => {\r\n\t\t\tmeta.get(propName).observers.push(callbackName)\r\n\t\t})\r\n\t}\r\n}\r\n\r\n// method decorator\r\n// hooks into existing getter/setter (like @reflect) and accepts function that is called\r\n// on value change, but before Ganymede gets to it so the value can be validated, limited, clipped, etc...\r\n// TODO: make this work with simple properties (and turn them into getter/setter)\r\nexport function validate(validator) {\r\n\treturn (ClassProto, propName, descriptor) => {\r\n\t\tvar originalSet = descriptor.set\r\n\t\tfunction set(newValue) {\r\n\t\t\tvar validated = validator.call(this, newValue, this)\r\n\t\t\toriginalSet.call(this, validated)\r\n\t\t}\r\n\t\tdescriptor.set = set\r\n\t\treturn descriptor\r\n\t}\r\n}\r\n\r\n\r\nexport function autobind(ClassProto, methodName, descriptor) {\r\n\tvar fn = descriptor.value\r\n\treturn {\r\n\t\tconfigurable: true,\r\n\t\tget() {\r\n\t\t\tvar bound = fn.bind(this)\r\n\t\t\tObject.defineProperty(this, methodName, {\r\n\t\t\t\tvalue: bound,\r\n\t\t\t\tconfigurable: true,\r\n\t\t\t\twritable: true\r\n\t\t\t})\r\n\t\t\treturn bound\r\n\t\t}\r\n\t}\r\n}\r\n","'use strict'\r\n\r\nimport {camelToKebab, kebabToCamel} from './util'\r\nimport {setupReflection, setupInstanceReflection, setupDefaultValues, setupPropertyObservers} from './sync'\r\nimport {setupEventListeners, killEventListeners, emit, promiseOnce} from './events'\r\nimport {setupTemplate, createIdList, solidifyTemplate} from './template'\r\nimport {getMetadata} from './metadata'\r\n\r\n\r\nexport {$, $$} from './util'\r\nexport {reflect, defaultValue} from './sync'\r\nexport {on, once, emit, scheduleEvent} from './events'\r\nexport {template, css} from './template'\r\nexport * from './decorators'\r\n\r\nexport var constructors = {}\r\nexport var awaitPromises = []\r\n\r\n//var documentReady = promiseOnce(document, 'readystatechange', document.readyState === 'complete')\r\n\r\nfunction awaitDocumentReady() {\r\n\tif (document.readyState === 'interactive')\r\n\t\treturn Promise.resolve()\r\n\telse\r\n\t\treturn promiseOnce(document, 'DOMContentLoaded')\r\n}\r\nfunction awaitPromisesReady() {\r\n\treturn Promise.all(awaitPromises)\r\n}\r\n\r\nexport var ready = awaitDocumentReady().then(awaitPromisesReady)\r\n\r\n// emit 'ganymede-ready' event to document when ganymede is ready\r\nready.then(() => emit(document, 'ganymede-ready'))\r\n\r\nfunction registerElement(Class, options) {\r\n\tvar meta = getMetadata(Class)\r\n\tmeta.preventIdList = options.preventIdList\r\n\tmeta.preventEventEmitter = options.preventEventEmitter\r\n\t//registerUnresolvedStyle(name)\r\n\tsolidifyTemplate(meta)\r\n\tsetupPropertyObservers(meta, Class)\r\n\tsetupReflection(meta, Class)\r\n\tcustomElements.define(options.name, Class)\r\n\tconstructors[Class.name] = Class\r\n\twindow[Class.name] = Class\r\n\treturn Class\r\n}\r\n\r\nexport function customElement(arg) {\r\n\tif (arg.constructor === Object) {\r\n\t\treturn Class => registerElement(Class, arg)\r\n\t} else if (arg.constructor === String) {\r\n\t\treturn Class => registerElement(Class, {name: arg})\r\n\t} else {\r\n\t\treturn registerElement(arg, {name: camelToKebab(arg.name)})\r\n\t}\r\n}\r\n\r\n/*\r\nexport function customElement(arg) {\r\n\tPromise.all(awaitPromises)\r\n\t\t.catch(e => {\r\n\t\t\tconsole.error('Loading polyfills failed, could not continue registering custom elements', e)\r\n\t\t})\r\n\t\t.then(() => {\r\n\t\t\tif (arg.constructor === Object) {\r\n\t\t\t\treturn Class => registerElement(Class, arg)\r\n\t\t\t} else if (arg.constructor === String) {\r\n\t\t\t\treturn Class => registerElement(Class, {name: arg})\r\n\t\t\t} else {\r\n\t\t\t\treturn registerElement(arg, {name: camelToKebab(arg.name)})\r\n\t\t\t}\r\n\t\t})\r\n\t\t.catch(e => {\r\n\t\t\tconsole.error('Error registering custom element', e)\r\n\t\t})\r\n}\r\n*/\r\n\r\n// factory for wrapping Ganymede Element and multiple mixins\r\nexport function ganymedeElement(...classes) {\r\n\tclass GanymedeElement extends Element {}\r\n\t// each class has different reflected/observed attributes\r\n\tGanymedeElement.observedAttributes = []\r\n\tclasses.unshift(GanymedeElement)\r\n\treturn classes.reduce((curr, next) => next(curr))\r\n}\r\n\r\n// TODO: check this.ownerDocument.defaultView to see if we've been\r\n//       inserted into a document with a browsing context, and avoid\r\n\r\nvar alreadyConnected = Symbol()\r\n\r\nclass Element extends HTMLElement {\r\n\r\n\t// observedAttributes must be finalized at registration time\r\n\tstatic observedAttributes = []\r\n\r\n\tconstructor() {\r\n\t\tsuper()\r\n\t\tvar Class = this.constructor\r\n\t\tvar meta = getMetadata(Class)\r\n\r\n\t\t// create shadow DOM and inject template if is defined\r\n\t\tif (meta.template) {\r\n\t\t\tsetupTemplate(this, meta)\r\n\t\t\t// create quick access list of all shadowroot thiss with [id]\r\n\t\t\tif (!meta.preventIdList)\r\n\t\t\t\tcreateIdList(this)\r\n\t\t}\r\n\t\t// extend this with EventEmitter API if not prevented\r\n\t\tsetupEventListeners(this, meta)\r\n\r\n\t\tif (this.emit) this.emit('created')\r\n\t}\r\n\r\n\tconnectedCallback() {\r\n\t\t// prevent setting up element after first connection\r\n\t\tif (this[alreadyConnected]) {\r\n\t\t\tif (this.emit) this.emit('connected')\r\n\t\t\treturn\r\n\t\t} else {\r\n\t\t\tthis[alreadyConnected] = true\r\n\t\t\tvar Class = this.constructor\r\n\t\t\tvar meta = getMetadata(Class)\r\n\r\n\t\t\t// setups synchronization of properties decorated with @reflect\r\n\t\t\t// between the JS object and corresponding HTML tag attributes\r\n\t\t\t// Note: Also reads descriptor.initializer and injects it into\r\n\t\t\t//       this right away so theres no delay due to babel\r\n\t\t\t//       applying the property values at the end of constructor\r\n\t\t\tsetupInstanceReflection(this, meta)\r\n\t\t\tsetupDefaultValues(this, meta)\r\n\r\n\t\t\t// TODO: figure out a better way to call this after users constructor\r\n\t\t\tif (this.emit) this.emit('connected')\r\n\t\t\t// DOM elements are initialized top down and children are still unavailable\r\n\t\t\t// by the time element is 'connected'. \r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\t// TODO, investigate: meta is shared for all instances, this 'constructed' thing is wrong\r\n\t\t\t\tmeta.constructed = true\r\n\t\t\t\tif (this.emit) this.emit('beforeready')\r\n\t\t\t\tif (this.ready) this.ready()\r\n\t\t\t\tif (this.emit) this.emit('ready')\r\n\t\t\t\tif (Class.preventReadyAnimation === undefined)\r\n\t\t\t\t\tthis.setAttribute('ready', '')\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tdisconnectedCallback() {\r\n\t\tif (this.emit) this.emit('disconnected')\r\n\t\tkillEventListeners(this, getMetadata(this.constructor))\r\n\t}\r\n\r\n\tshow() {\r\n\t\tthis.emit('show')\r\n\t}\r\n\r\n\thide() {\r\n\t\tthis.emit('hide')\r\n\t}\r\n\r\n}\r\n"],"names":["$","document","querySelector","bind","$$","selector","Array","from","querySelectorAll","camelToKebab","string","split","join","toLowerCase","kebabToCamel","replace","g","toUpperCase","runAll","iterable","forEach","fc","meta","Symbol","getMetadata","Class","Metadata","properties","Map","attributes","template","undefined","initializers","scheduledEvents","scheduledOnce","className","name","elementName","propName","getProp","attrName","propMeta","PropAttrMeta","set","has","_createPropAttr","get","callback","observers","type","reflect","reflectSkip","deserializeSkip","getsetAttached","getter","setter","initValue","defaultValue","symbol","ClassProto","descriptor","constructor","observedAttributes","push","initializer","writable","determineType","context","output","setupGetSet","defineProperty","value","setupPropertyObservers","prototype","getOwnPropertyNames","methodName","endsWith","slice","includes","length","Object","getOwnPropertyDescriptor","getDefaultDescriptor","setupReflection","attributeChangedCallback","oldValue","newValue","setupInstanceReflection","element","Boolean","hasAttribute","removeAttribute","setAttribute","initAttrValue","_deserialize","setupDefaultValues","Number","isNaN","NaN","call","reflectProperty","constructed","observerName","Function","deserializeAttribute","avoidIfHasValue","attrValue","getAttribute","String","_reflect","canSkipDeserialize","propValue","on","args","eventName","pop","condition","nodeOrPath","nodePath","globalNode","callbackName","errorMsg","node","traverseNodePath","Error","once","attachEvent","warn","promiseOnce","target","rejectIfNotMet","Promise","resolve","reject","addEventListener","pathSplit","pathStep","shift","listener","e","detail","registerKillback","removeEventListener","scheduleEvent","scheduleOnce","GPKillbacks","killback","add","EEKillbacks","DOMEventEmitter","boundListener","delete","off","emit","data","event","CustomEvent","Event","dispatchEvent","setupEventListeners","Set","preventEventEmitter","killEventListeners","setupTemplate","clonedTemplate","importNode","content","attachShadow","mode","shadowRoot","appendChild","window","ShadyCSS","styleElement","applyStyle","createIdList","id","solidifyTemplate","templateString","styleString","createElement","innerHTML","prepareTemplate","css","urlOrStyle","nonenumerable","enumerable","observe","observedProperties","validate","validator","originalSet","validated","autobind","fn","bound","constructors","awaitPromises","awaitDocumentReady","readyState","awaitPromisesReady","all","ready","then","registerElement","options","preventIdList","define","customElement","arg","ganymedeElement","classes","GanymedeElement","Element","unshift","reduce","curr","next","alreadyConnected","HTMLElement","preventReadyAnimation"],"mappings":"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"}